"use strict";import DropDown from"./DropDown.min.js";import HideIt from"./HideIt.min.js";import ShowIt from"./ShowIt.min.js";import Comment from"./Comment.min.js";import Slicer from"./Slicer.min.js";$((()=>{const t=new Slicer([],{start:0,end:5}),e=+localStorage.getItem("currentBookId");new HideIt({selector:".rt-loader__content",px:"50px",seconds:.5,callback:()=>{$(".rt-loader").remove();new ShowIt({selector:"header, footer, section",seconds:.5}).smoothShow()}}).smoothHideY();let n,o,a,i,r=1,m=1;$.get("./database/books/information.json",{},(t=>{$(t).each(((t,n)=>{n.id===e&&(o=n.chapters)})),$.get(`${o[m].link}`,{dataType:"text"},(t=>{n=p(t),a=Object.keys(n).length,i=Object.keys(o).length;const e=[];let l=1;for(;l<=a;l++)e[l-1]=l;new DropDown({dataAtr:"pages",buttonSize:"normal",listSize:"100%",transition:.2,title:"Страницы",inputName:"link",list:c(a),callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){r=parseInt($(this).text()),r>a?document.location.href="book.html":($(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h())}))}}).create(),new DropDown({dataAtr:"chapters",classes:["rt-mr-default"],buttonSize:"normal",listSize:"100%",transition:.2,title:"Главы",inputName:"link",list:c(i),callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){m=parseInt($(this).text()),r=1,$.get(`${o[m].link}`,{dataType:"text"},(t=>{n=p(t),a=Object.keys(n).length,$(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h(),s()}))}))}}).create(),$(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`)}))})),$("button#next-page").on("click",(function(){if(r>=a){if(o[++m])return void g();document.location.href="book.html"}$(".rt-page__text").html(n[++r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h()})),$("button#last-page").on("click",(function(){if(1===r){if(o[--m])return void g();document.location.href="book.html"}$(".rt-page__text").html(n[--r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h()}));let l=!1;function c(t){const e=[];for(let n=1;n<=t;n++)e[n-1]=n;return e}function s(){$('[data-dropdown="pages"]').html(""),new DropDown({dataAtr:"pages",buttonSize:"normal",listSize:"100%",transition:.2,title:"Страницы",inputName:"link",list:c(a),callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){r=parseInt($(this).text()),r>a?document.location.href="book.html":($(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h())}))}}).create()}$("button#show-more-comments").on("click",(()=>{t.indexes={start:t.indexes.end,end:t.indexes.end+5},t.addSlicedComments(".rt-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5),t.indexes.end<=t.data.length||(l=!0)})),Comment.dynamicTextareaHeight(),$("#main-textarea").on("submit",(function(e){e.preventDefault();const n=$("textarea",$(this));t.data.push(new Comment({name:"Гость",date:(new Date).toLocaleDateString(),text:$(n).val(),img:"./images/guest.png"})),n.val(""),t.indexes.end>=t.data.length&&(l=!0),l&&(t.indexes={start:t.data.length-1,end:t.data.length},t.addSlicedComments("#main-comments"),ShowIt.smoothShowSlicedElements(".rt-comments > .rt-comment",t.indexes,.5))}));let d=[];function h(){$.get("./database/comments/chapter-comments.json",{},(n=>{$(".rt-comments").html(""),d=[],$(n).each(((t,n)=>{n.bookId===e&&n.page===r&&d.push(new Comment(n))})),t.data=d,t.indexes={start:0,end:5},t.addSlicedComments(".rt-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5)}))}function p(t){const e=t.split("");let n={},o={start:0,end:3115},a=1;return n[a]=[],$(e).each(((t,e)=>{t>=o.start&&t<=o.end?n[a]+=e:(n[++a]=[],o.start=o.end,o.end+=3115)})),n}function g(){r=1,$.get(`${o[m].link}`,{dataType:"text"},(t=>{n=p(t),a=Object.keys(n).length,$(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h(),s()}))}h()}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXB0ZXIubWluLmpzIl0sIm5hbWVzIjpbIkRyb3BEb3duIiwiSGlkZUl0IiwiU2hvd0l0IiwiQ29tbWVudCIsIlNsaWNlciIsIiQiLCJzbGljZXIiLCJzdGFydCIsImVuZCIsImJvb2tJZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZWxlY3RvciIsInB4Iiwic2Vjb25kcyIsImNhbGxiYWNrIiwicmVtb3ZlIiwic21vb3RoU2hvdyIsInNtb290aEhpZGVZIiwicGFnZXMiLCJjaGFwdGVycyIsInBhZ2VzQ291bnQiLCJjaGFwdGVyc0NvdW50IiwiY3VycmVudFBhZ2UiLCJjdXJyZW50Q2hhcHRlciIsImdldCIsImRhdGEiLCJlYWNoIiwiaW5kZXgiLCJib29rIiwiaWQiLCJsaW5rIiwiZGF0YVR5cGUiLCJyZXR1cm5QYWdlcyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJhcnJheSIsImkiLCJkYXRhQXRyIiwiYnV0dG9uU2l6ZSIsImxpc3RTaXplIiwidHJhbnNpdGlvbiIsInRpdGxlIiwiaW5wdXROYW1lIiwibGlzdCIsInJldHVybkxpc3QiLCJkcm9wRG93biIsIm9uIiwicGFyc2VJbnQiLCJ0aGlzIiwidGV4dCIsImRvY3VtZW50IiwibG9jYXRpb24iLCJocmVmIiwiaHRtbCIsInVwZGF0ZUNvbW1lbnRzIiwiY3JlYXRlIiwiY2xhc3NlcyIsImNyZWF0ZU5ld0Ryb3BEb3duUGFnZXMiLCJsb2FkTmV3Q2hhcHRlciIsImFsbFNob3dlZCIsIm51bSIsImluZGV4ZXMiLCJhZGRTbGljZWRDb21tZW50cyIsInNtb290aFNob3dTbGljZWRFbGVtZW50cyIsImR5bmFtaWNUZXh0YXJlYUhlaWdodCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ0ZXh0YXJlYSIsInB1c2giLCJuYW1lIiwiZGF0ZSIsIkRhdGUiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJ2YWwiLCJpbWciLCJjb21tZW50cyIsImNvbW1lbnRQcm9wcyIsInBhZ2UiLCJzcGxpdCIs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RSxTQUFTOUIsRUFBWVAsR0FDakIsTUFBTVcsRUFBUVgsRUFBS3NELE1BQU0sSUFDekIsSUFBSTdELEVBQVEsR0FDUjhELEVBQU0sQ0FBRTFFLE1BQU8sRUFBR0MsSUFBSyxNQUN2QjBFLEVBQVUsRUFjZCxPQVhBL0QsRUFBTStELEdBQVcsR0FDakI3RSxFQUFFZ0MsR0FBT1YsTUFBSyxDQUFDQyxFQUFPdUQsS0FDZHZELEdBQVNxRCxFQUFJMUUsT0FBU3FCLEdBQVNxRCxFQUFJekUsSUFDbkNXLEVBQU0rRCxJQUFZQyxHQUd0QmhFLElBQVErRCxHQUFXLEdBQ25CRCxFQUFJMUUsTUFBUTBFLEVBQUl6RSxJQUNoQnlFLEVBQUl6RSxLQUFPLFNBR1JXLEVBR1gsU0FBU3lDLElBQ0xyQyxFQUFjLEVBRWRsQixFQUFFb0IsSUFBSSxHQUFHTCxFQUFTSSxHQUFnQk8sT0FBUSxDQUFDQyxTQUFVLFNBQVVELElBQzNEWixFQUFRYyxFQUFZRixHQUNwQlYsRUFBYWEsT0FBT0MsS0FBS2hCLEdBQU9pQixPQUVoQy9CLEVBQUUsa0JBQWtCa0QsS0FBS3BDLEVBQU1JLElBQy9CbEIsRUFBRSx1QkFBdUJrRCxLQUFLLFlBQVloQyxLQUMxQ2xCLEVBQUUsMEJBQTBCa0QsS0FBSyxTQUFTL0IsS0FFMUNnQyxJQUNBRyxPQW5DUkgiLCJmaWxlIjoiY2hhcHRlci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5pbXBvcnQgRHJvcERvd24gZnJvbSAnLi9Ecm9wRG93bi5taW4uanMnO1xyXG5pbXBvcnQgSGlkZUl0IGZyb20gJy4vSGlkZUl0Lm1pbi5qcyc7XHJcbmltcG9ydCBTaG93SXQgZnJvbSAnLi9TaG93SXQubWluLmpzJztcclxuaW1wb3J0IENvbW1lbnQgZnJvbSAnLi9Db21tZW50Lm1pbi5qcyc7XHJcbmltcG9ydCBTbGljZXIgZnJvbSAnLi9TbGljZXIubWluLmpzJztcclxuXHJcbiQoKCkgPT4ge1xyXG4gICAgY29uc3Qgc2xpY2VyID0gbmV3IFNsaWNlcihbXSwgeyBzdGFydDogMCwgZW5kOiA1IH0pOyBcclxuICAgIGNvbnN0IGJvb2tJZCA9ICtsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudEJvb2tJZCcpO1xyXG5cclxuICAgIC8vIFNNT09USCBTSE9XIC0tLS0+XHJcbiAgICBjb25zdCBzcGlubmVyID0gbmV3IEhpZGVJdCh7XHJcbiAgICAgICAgc2VsZWN0b3I6ICcucnQtbG9hZGVyX19jb250ZW50JyxcclxuICAgICAgICBweDogJzUwcHgnLFxyXG4gICAgICAgIHNlY29uZHM6IDAuNSxcclxuICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xyXG4gICAgICAgICAgICAkKCcucnQtbG9hZGVyJykucmVtb3ZlKCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBibG9ja3MgPSBuZXcgU2hvd0l0KHsgc2VsZWN0b3I6ICdoZWFkZXIsIGZvb3Rlciwgc2VjdGlvbicsIHNlY29uZHM6IDAuNSB9KTtcclxuICAgICAgICAgICAgYmxvY2tzLnNtb290aFNob3coKTsgICAgXHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuICAgIHNwaW5uZXIuc21vb3RoSGlkZVkoKTtcclxuICAgIC8vIDwtLS0tIFNNT09USCBTSE9XXHJcblxyXG4gICAgXHJcbiAgICBsZXQgY3VycmVudFBhZ2UgPSAxO1xyXG4gICAgbGV0IGN1cnJlbnRDaGFwdGVyID0gMTtcclxuXHJcbiAgICBsZXQgcGFnZXM7XHJcbiAgICBsZXQgY2hhcHRlcnM7XHJcblxyXG4gICAgbGV0IHBhZ2VzQ291bnQ7XHJcbiAgICBsZXQgY2hhcHRlcnNDb3VudDtcclxuXHJcbiAgICAkLmdldCgnLi9kYXRhYmFzZS9ib29rcy9pbmZvcm1hdGlvbi5qc29uJywge30sIChkYXRhKSA9PiB7XHJcblxyXG4gICAgICAgICQoZGF0YSkuZWFjaCgoaW5kZXgsIGJvb2spID0+IHtcclxuICAgICAgICAgICAgaWYgKGJvb2suaWQgIT09IGJvb2tJZCkgcmV0dXJuXHJcbiAgICAgICAgICAgIGNoYXB0ZXJzID0gYm9vay5jaGFwdGVycztcclxuICAgICAgICB9KVxyXG4gICAgICAgIFxyXG4gICAgICAgICQuZ2V0KGAke2NoYXB0ZXJzW2N1cnJlbnRDaGFwdGVyXS5saW5rfWAsIHtkYXRhVHlwZTogXCJ0ZXh0XCJ9LCAobGluaykgPT4ge1xyXG4gICAgICAgICAgICBwYWdlcyA9IHJldHVyblBhZ2VzKGxpbmspO1xyXG5cclxuICAgICAgICAgICAgcGFnZXNDb3VudCA9IE9iamVjdC5rZXlzKHBhZ2VzKS5sZW5ndGhcclxuICAgICAgICAgICAgY2hhcHRlcnNDb3VudCA9IE9iamVjdC5rZXlzKGNoYXB0ZXJzKS5sZW5ndGhcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGFycmF5ID0gW107XHJcbiAgICAgICAgICAgIGxldCBpID0gMTtcclxuICAgICAgICAgICAgZm9yKGk7IGkgPD0gcGFnZXNDb3VudDsgaSsrKSB7IGFycmF5W2kgLSAxXSA9IGkgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG5ldyBEcm9wRG93bih7XHJcbiAgICAgICAgICAgICAgICBkYXRhQXRyOiAncGFnZXMnLFxyXG4gICAgICAgICAgICAgICAgYnV0dG9uU2l6ZTogJ25vcm1hbCcsXHJcbiAgICAgICAgICAgICAgICBsaXN0U2l6ZTogJzEwMCUnLFxyXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogMC4yLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICfQodGC0YDQsNC90LjRhtGLJyxcclxuICAgICAgICAgICAgICAgIGlucHV0TmFtZTogJ2xpbmsnLFxyXG4gICAgICAgICAgICAgICAgbGlzdDogcmV0dXJuTGlzdChwYWdlc0NvdW50KSxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihkcm9wRG93bikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSAkKCcucnQtZHJvcGRvd25fX2l0ZW0gYnV0dG9uJywgZHJvcERvd24gKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9ucy5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhZ2UgPSBwYXJzZUludCgkKHRoaXMpLnRleHQoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBhZ2UgPiBwYWdlc0NvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gXCJib29rLmh0bWxcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzW2N1cnJlbnRQYWdlXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS5jcmVhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIG5ldyBEcm9wRG93bih7XHJcbiAgICAgICAgICAgICAgICBkYXRhQXRyOiAnY2hhcHRlcnMnLFxyXG4gICAgICAgICAgICAgICAgY2xhc3NlczogWydydC1tci1kZWZhdWx0J10sXHJcbiAgICAgICAgICAgICAgICBidXR0b25TaXplOiAnbm9ybWFsJyxcclxuICAgICAgICAgICAgICAgIGxpc3RTaXplOiAnMTAwJScsXHJcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiAwLjIsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJ9CT0LvQsNCy0YsnLFxyXG4gICAgICAgICAgICAgICAgaW5wdXROYW1lOiAnbGluaycsXHJcbiAgICAgICAgICAgICAgICBsaXN0OiByZXR1cm5MaXN0KGNoYXB0ZXJzQ291bnQpLFxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKGRyb3BEb3duKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnV0dG9ucyA9ICQoJy5ydC1kcm9wZG93bl9faXRlbSBidXR0b24nLCBkcm9wRG93biApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBidXR0b25zLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2hhcHRlciA9IHBhcnNlSW50KCQodGhpcykudGV4dCgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5nZXQoYCR7Y2hhcHRlcnNbY3VycmVudENoYXB0ZXJdLmxpbmt9YCwge2RhdGFUeXBlOiBcInRleHRcIn0sIChsaW5rKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlcyA9IHJldHVyblBhZ2VzKGxpbmspO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZXNDb3VudCA9IE9iamVjdC5rZXlzKHBhZ2VzKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzW2N1cnJlbnRQYWdlXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1wYWdlJykuaHRtbChg0KHRgtGA0LDQvdC40YbQsCAke2N1cnJlbnRQYWdlfWApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tY2hhcHRlcicpLmh0bWwoYNCT0LvQsNCy0LAgJHtjdXJyZW50Q2hhcHRlcn1gKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNvbW1lbnRzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVOZXdEcm9wRG93blBhZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLmNyZWF0ZSgpO1xyXG5cclxuICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzW2N1cnJlbnRQYWdlXSk7XHJcbiAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcbiAgICAgICAgfSlcclxuIFxyXG4gICAgfSlcclxuXHJcbiAgICBcclxuXHJcbiAgICAvLyBCVVRUT04gTkVYVCBQQUdFIC0tLT5cclxuICAgICQoJ2J1dHRvbiNuZXh0LXBhZ2UnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFBhZ2UgPj0gcGFnZXNDb3VudCkge1xyXG4gICAgICAgICAgICBpZiAoY2hhcHRlcnNbKytjdXJyZW50Q2hhcHRlcl0pIHtcclxuICAgICAgICAgICAgICAgIGxvYWROZXdDaGFwdGVyKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gXCJib29rLmh0bWxcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICQoJy5ydC1wYWdlX190ZXh0JykuaHRtbChwYWdlc1srK2N1cnJlbnRQYWdlXSlcclxuICAgICAgICAkKCcucnQtcGFnZV9faW5mby1wYWdlJykuaHRtbChg0KHRgtGA0LDQvdC40YbQsCAke2N1cnJlbnRQYWdlfWApO1xyXG4gICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcblxyXG4gICAgICAgIHVwZGF0ZUNvbW1lbnRzKCk7XHJcbiAgICB9KVxyXG4gICAgLy8gPC0tLS0gQlVUVE9OIE5FWFQgUEFHRVxyXG5cclxuXHJcbiAgICAvLyBCVVRUT04gTEFTVCBQQUdFIC0tLT5cclxuICAgICQoJ2J1dHRvbiNsYXN0LXBhZ2UnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFBhZ2UgPT09IDEpIHtcclxuICAgICAgICAgICAgaWYgKGNoYXB0ZXJzWy0tY3VycmVudENoYXB0ZXJdKSB7XHJcbiAgICAgICAgICAgICAgICBsb2FkTmV3Q2hhcHRlcigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IFwiYm9vay5odG1sXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKCcucnQtcGFnZV9fdGV4dCcpLmh0bWwocGFnZXNbLS1jdXJyZW50UGFnZV0pXHJcbiAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tcGFnZScpLmh0bWwoYNCh0YLRgNCw0L3QuNGG0LAgJHtjdXJyZW50UGFnZX1gKTtcclxuICAgICAgICAkKCcucnQtcGFnZV9faW5mby1jaGFwdGVyJykuaHRtbChg0JPQu9Cw0LLQsCAke2N1cnJlbnRDaGFwdGVyfWApO1xyXG5cclxuICAgICAgICB1cGRhdGVDb21tZW50cygpO1xyXG4gICAgfSlcclxuICAgIC8vIDwtLS0tIEJVVFRPTiBMQVNUIFBBR0VcclxuXHJcblxyXG4gICAgLy8gU0hPVyBNT1JFIENPTU1FTlRTIC0tLS0+XHJcbiAgICBsZXQgYWxsU2hvd2VkID0gZmFsc2U7XHJcbiAgICAkKCdidXR0b24jc2hvdy1tb3JlLWNvbW1lbnRzJykub24oJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgIHNsaWNlci5pbmRleGVzID0geyBzdGFydDogc2xpY2VyLmluZGV4ZXMuZW5kLCBlbmQ6IHNsaWNlci5pbmRleGVzLmVuZCArIDUgfTtcclxuICAgICAgICBzbGljZXIuYWRkU2xpY2VkQ29tbWVudHMoJy5ydC1jb21tZW50cycpO1xyXG4gICAgICAgIFNob3dJdC5zbW9vdGhTaG93U2xpY2VkRWxlbWVudHMoJy5ydC1jb21tZW50Jywgc2xpY2VyLmluZGV4ZXMsIDAuNSk7XHJcblxyXG4gICAgICAgIGlmIChzbGljZXIuaW5kZXhlcy5lbmQgPD0gc2xpY2VyLmRhdGEubGVuZ3RoKSByZXR1cm5cclxuICAgICAgICBhbGxTaG93ZWQgPSB0cnVlOyAgIFxyXG4gICAgfSlcclxuICAgIC8vIDwtLS0tIFNIT1cgTU9SRSBDT01NRU5UU1xyXG5cclxuXHJcbiAgICAvLyBURVhUQVJFQSAtLS0tPlxyXG4gICAgQ29tbWVudC5keW5hbWljVGV4dGFyZWFIZWlnaHQoKTtcclxuICAgICQoJyNtYWluLXRleHRhcmVhJykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgY29uc3QgdGV4dGFyZWEgPSAkKCd0ZXh0YXJlYScsICQodGhpcykpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNsaWNlci5kYXRhLnB1c2gobmV3IENvbW1lbnQoe1xyXG4gICAgICAgICAgICBuYW1lOiAn0JPQvtGB0YLRjCcsXHJcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCksXHJcbiAgICAgICAgICAgIHRleHQ6ICQodGV4dGFyZWEpLnZhbCgpLFxyXG4gICAgICAgICAgICBpbWc6ICcuL2ltYWdlcy9ndWVzdC5wbmcnXHJcbiAgICAgICAgfSkpXHJcbiAgICAgICAgdGV4dGFyZWEudmFsKCcnKTtcclxuXHJcbiAgICAgICAgaWYgKHNsaWNlci5pbmRleGVzLmVuZCA+PSBzbGljZXIuZGF0YS5sZW5ndGgpIGFsbFNob3dlZCA9IHRydWU7ICAgXHJcbiAgICAgICAgaWYgKCAhIGFsbFNob3dlZCkgcmV0dXJuXHJcblxyXG4gICAgICAgIHNsaWNlci5pbmRleGVzID0geyBzdGFydDogc2xpY2VyLmRhdGEubGVuZ3RoIC0gMSwgZW5kOiBzbGljZXIuZGF0YS5sZW5ndGggfTtcclxuICAgICAgICBzbGljZXIuYWRkU2xpY2VkQ29tbWVudHMoJyNtYWluLWNvbW1lbnRzJyk7XHJcbiAgICAgICAgU2hvd0l0LnNtb290aFNob3dTbGljZWRFbGVtZW50cygnLnJ0LWNvbW1lbnRzID4gLnJ0LWNvbW1lbnQnLCBzbGljZXIuaW5kZXhlcywgMC41KTtcclxuICAgIH0pXHJcbiAgICAvLyA8LS0tLSBURVhUQVJFQVxyXG5cclxuXHJcbiAgICAvLyBIRUxQRVIgRlVOQ1RJT05TIC0tLS0+XHJcbiAgICBmdW5jdGlvbiByZXR1cm5MaXN0KG51bSkge1xyXG4gICAgICAgIGNvbnN0IGFycmF5ID0gW107XHJcbiAgICAgICAgZm9yKGxldCBpID0gMTsgaSA8PSBudW07IGkrKykgeyBhcnJheVtpIC0gMV0gPSBpIH07XHJcbiAgICAgICAgcmV0dXJuIGFycmF5XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld0Ryb3BEb3duUGFnZXMoKSB7XHJcbiAgICAgICAgJCgnW2RhdGEtZHJvcGRvd249XCJwYWdlc1wiXScpLmh0bWwoJycpO1xyXG4gICAgICAgIG5ldyBEcm9wRG93bih7XHJcbiAgICAgICAgICAgIGRhdGFBdHI6ICdwYWdlcycsXHJcbiAgICAgICAgICAgIGJ1dHRvblNpemU6ICdub3JtYWwnLFxyXG4gICAgICAgICAgICBsaXN0U2l6ZTogJzEwMCUnLFxyXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiAwLjIsXHJcbiAgICAgICAgICAgIHRpdGxlOiAn0KHRgtGA0LDQvdC40YbRiycsXHJcbiAgICAgICAgICAgIGlucHV0TmFtZTogJ2xpbmsnLFxyXG4gICAgICAgICAgICBsaXN0OiByZXR1cm5MaXN0KHBhZ2VzQ291bnQpLFxyXG4gICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oZHJvcERvd24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSAkKCcucnQtZHJvcGRvd25fX2l0ZW0gYnV0dG9uJywgZHJvcERvd24gKTtcclxuXHJcbiAgICAgICAgICAgICAgICBidXR0b25zLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gcGFyc2VJbnQoJCh0aGlzKS50ZXh0KCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBhZ2UgPiBwYWdlc0NvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBcImJvb2suaHRtbFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX190ZXh0JykuaHRtbChwYWdlc1tjdXJyZW50UGFnZV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tY2hhcHRlcicpLmh0bWwoYNCT0LvQsNCy0LAgJHtjdXJyZW50Q2hhcHRlcn1gKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KS5jcmVhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkcm9wRG93bihwcm9wcywgY291bnQpIHtcclxuICAgICAgICBjb25zdCBhcnJheSA9IFtdO1xyXG4gICAgICAgIGxldCBpID0gMTtcclxuICAgICAgICBmb3IoaTsgaSA8PSBjb3VudDsgaSsrKSB7IGFycmF5W2kgLSAxXSA9IGkgfTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gbmV3IERyb3BEb3duKHtcclxuICAgICAgICAgICAgZGF0YUF0cjogcHJvcHMuZGF0YUF0cixcclxuICAgICAgICAgICAgY2xhc3NlczogcHJvcHMuY2xhc3NlcyxcclxuICAgICAgICAgICAgYnV0dG9uU2l6ZTogcHJvcHMuYnV0dG9uU2l6ZSxcclxuICAgICAgICAgICAgbGlzdFNpemU6IHByb3BzLmxpc3RTaXplLFxyXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiBwcm9wcy50cmFuc2l0aW9uLFxyXG4gICAgICAgICAgICB0aXRsZTogcHJvcHMudGl0bGUsXHJcbiAgICAgICAgICAgIGlucHV0TmFtZTogcHJvcHMuaW5wdXROYW1lLFxyXG4gICAgICAgICAgICBjYWxsYmFjazogcHJvcHMuY2FsbGJhY2ssXHJcbiAgICAgICAgICAgIGxpc3Q6IGFycmF5XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBsZXQgY29tbWVudHMgPSBbXTtcclxuICAgIGZ1bmN0aW9uIHVwZGF0ZUNvbW1lbnRzKCkge1xyXG4gICAgICAgICQuZ2V0KCcuL2RhdGFiYXNlL2NvbW1lbnRzL2NoYXB0ZXItY29tbWVudHMuanNvbicsIHt9LCAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAkKCcucnQtY29tbWVudHMnKS5odG1sKCcnKTtcclxuICAgICAgICAgICAgY29tbWVudHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICQoZGF0YSkuZWFjaCgoaW5kZXgsIGNvbW1lbnRQcm9wcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoY29tbWVudFByb3BzLmJvb2tJZCAhPT0gYm9va0lkKSByZXR1cm5cclxuICAgICAgICAgICAgICAgIGlmIChjb21tZW50UHJvcHMucGFnZSAhPT0gY3VycmVudFBhZ2UpIHJldHVyblxyXG4gICAgICAgICAgICAgICAgY29tbWVudHMucHVzaChuZXcgQ29tbWVudChjb21tZW50UHJvcHMpKTtcclxuICAgICAgICAgICAgfSlcclxuICAgIFxyXG4gICAgICAgICAgICBzbGljZXIuZGF0YSA9IGNvbW1lbnRzO1xyXG4gICAgICAgICAgICBzbGljZXIuaW5kZXhlcyA9IHsgc3RhcnQ6IDAsIGVuZDogNSB9O1xyXG4gICAgICAgICAgICBzbGljZXIuYWRkU2xpY2VkQ29tbWVudHMoJy5ydC1jb21tZW50cycpO1xyXG4gICAgICAgICAgICBTaG93SXQuc21vb3RoU2hvd1NsaWNlZEVsZW1lbnRzKCcucnQtY29tbWVudCcsIHNsaWNlci5pbmRleGVzLCAwLjUpOyBcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgdXBkYXRlQ29tbWVudHMoKTtcclxuXHJcbiAgICBmdW5jdGlvbiByZXR1cm5QYWdlcyhkYXRhKSB7XHJcbiAgICAgICAgY29uc3QgYXJyYXkgPSBkYXRhLnNwbGl0KCcnKTtcclxuICAgICAgICBsZXQgcGFnZXMgPSB7fTtcclxuICAgICAgICBsZXQgd2F5ID0geyBzdGFydDogMCwgZW5kOiAzMTE1fTtcclxuICAgICAgICBsZXQgcGFnZU51bSA9IDE7XHJcblxyXG5cclxuICAgICAgICBwYWdlc1twYWdlTnVtXSA9IFtdO1xyXG4gICAgICAgICQoYXJyYXkpLmVhY2goKGluZGV4LCBpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA+PSB3YXkuc3RhcnQgJiYgaW5kZXggPD0gd2F5LmVuZCkge1xyXG4gICAgICAgICAgICAgICAgcGFnZXNbcGFnZU51bV0gKz0gaXRlbTtcclxuICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBhZ2VzWysrcGFnZU51bV0gPSBbXTtcclxuICAgICAgICAgICAgd2F5LnN0YXJ0ID0gd2F5LmVuZDtcclxuICAgICAgICAgICAgd2F5LmVuZCArPSAzMTE1O1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHBhZ2VzIFxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGxvYWROZXdDaGFwdGVyKCkge1xyXG4gICAgICAgIGN1cnJlbnRQYWdlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgJC5nZXQoYCR7Y2hhcHRlcnNbY3VycmVudENoYXB0ZXJdLmxpbmt9YCwge2RhdGFUeXBlOiBcInRleHRcIn0sIChsaW5rKSA9PiB7XHJcbiAgICAgICAgICAgIHBhZ2VzID0gcmV0dXJuUGFnZXMobGluayk7XHJcbiAgICAgICAgICAgIHBhZ2VzQ291bnQgPSBPYmplY3Qua2V5cyhwYWdlcykubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzW2N1cnJlbnRQYWdlXSk7XHJcbiAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcbiAgICBcclxuICAgICAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgICAgICAgICAgY3JlYXRlTmV3RHJvcERvd25QYWdlcygpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICAvLyA8LS0tLSBIRUxQRVIgRlVOQ1RJT05TXHJcblxyXG59KSJdfQ==
