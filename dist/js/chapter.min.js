"use strict";import DropDown from"./DropDown.min.js";import HideIt from"./HideIt.min.js";import ShowIt from"./ShowIt.min.js";import Comment from"./Comment.min.js";import Slicer from"./Slicer.min.js";$((()=>{const t=new Slicer([],{start:0,end:5}),e=parseInt($("body").data().bookid);new HideIt({selector:".rt-loader__content",px:"50px",seconds:.5,callback:()=>{$(".rt-loader").remove();new ShowIt({selector:"header, footer, section",seconds:.5}).smoothShow()}}).smoothHideY();let n,o,a,i,m=1,r=localStorage.getItem("chapterNum");$.get("../database/books/information.json",{},(t=>{$(t).each(((t,n)=>{n.id===e&&(o=n.chapters)})),$.get(`${o[r].link}`,{dataType:"text"},(t=>{n=h(t),a=Object.keys(n).length,i=Object.keys(o).length,l({dataAtr:"pages",buttonSize:"normal",listSize:"100%",transition:.2,title:"Страницы",inputName:"link",callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){m=parseInt($(this).text()),m>a?document.location.href="book.html":($(".rt-page__text").html(n[m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`),d())}))}},a).create(),l({dataAtr:"chapters",classes:["rt-mr-default"],buttonSize:"normal",listSize:"100%",transition:.2,title:"Главы",inputName:"link",callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){r=parseInt($(this).text()),m=1,$.get(`${o[r].link}`,{dataType:"text"},(t=>{n=h(t),a=Object.keys(n).length})),$(".rt-page__text").html(n[m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`),d()}))}},i).create(),$(".rt-page__text").html(n[m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`)}))})),$("button#next-page").on("click",(function(){m>=a?document.location.href="book.html":($(".rt-page__text").html(n[++m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`),d())})),$("button#last-page").on("click",(function(){1!==m?($(".rt-page__text").html(n[--m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`),d()):document.location.href="book.html"}));let s=!1;function l(t,e){const n=[];let o=1;for(;o<=e;o++)n[o-1]=o;return new DropDown({dataAtr:t.dataAtr,classes:t.classes,buttonSize:t.buttonSize,listSize:t.listSize,transition:t.transition,title:t.title,inputName:t.inputName,callback:t.callback,list:n})}$("button#show-more-comments").on("click",(()=>{t.indexes={start:t.indexes.end,end:t.indexes.end+5},t.addSlicedComments(".rt-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5),t.indexes.end<=t.data.length||(s=!0)})),Comment.dynamicTextareaHeight(),$("#main-textarea").on("submit",(function(e){e.preventDefault();const n=$("textarea",$(this));t.data.push(new Comment({name:"Гость",date:(new Date).toLocaleDateString(),text:$(n).val(),img:"./images/user-image.jpg"})),n.val(""),t.indexes.end>=t.data.length&&(s=!0),s&&(t.indexes={start:t.data.length-1,end:t.data.length},t.addSlicedComments("#main-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5))}));let c=[];function d(){$.get("../database/comments/chapter-comments.json",{},(n=>{$(".rt-comments").html(""),c=[],$(n).each(((t,n)=>{n.bookId===e&&n.page===m&&c.push(new Comment(n))})),t.data=c,t.indexes={start:0,end:5},t.addSlicedComments(".rt-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5)}))}function h(t){const e=t.split("");let n={},o={start:0,end:3115},a=1;return n[a]=[],$(e).each(((t,e)=>{t>=o.start&&t<=o.end?n[a]+=e:(n[++a]=[],o.start=o.end,o.end+=3115)})),n}d()}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXB0ZXIubWluLmpzIl0sIm5hbWVzIjpbIkRyb3BEb3duIiwiSGlkZUl0IiwiU2hvd0l0IiwiQ29tbWVudCIsIlNsaWNlciIsIiQiLCJzbGljZXIiLCJzdGFydCIsImVuZCIsImJvb2tJZCIsInBhcnNlSW50IiwiZGF0YSIsImJvb2tpZCIsInNlbGVjdG9yIiwicHgiLCJzZWNvbmRzIiwiY2FsbGJhY2siLCJyZW1vdmUiLCJzbW9vdGhTaG93Iiwic21vb3RoSGlkZVkiLCJwYWdlcyIsImNoYXB0ZXJzIiwicGFnZXNDb3VudCIsImNoYXB0ZXJzQ291bnQiLCJjdXJyZW50UGFnZSIsImN1cnJlbnRDaGFwdGVyIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImdldCIsImVhY2giLCJpbmRleCIsImJvb2siLCJpZCIsImxpbmsiLCJkYXRhVHlwZSIsInJldHVyblBhZ2VzIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsImRyb3BEb3duIiwiZGF0YUF0ciIsImJ1dHRvblNpemUiLCJsaXN0U2l6ZSIsInRyYW5zaXRpb24iLCJ0aXRsZSIsImlucHV0TmFtZSIsIm9uIiwidGhpcyIsInRleHQiLCJkb2N1bWVudCIsImxvY2F0aW9uIiwiaHJlZiIsImh0bWwiLCJ1cGRhdGVDb21tZW50cyIsImNyZWF0ZSIsImNsYXNzZXMiLCJhbGxTaG93ZWQiLCJwcm9wcyIsImNvdW50IiwiYXJyYXkiLCJpIiwibGlzdCIsImluZGV4ZXMiLCJhZGRTbGljZWRDb21tZW50cyIsInNtb290aFNob3dTbGljZWRFbGVtZW50cyIsImR5bmFtaWNUZXh0YXJlYUhlaWdodCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ0ZXh0YXJlYSIsInB1c2giLCJuYW1lIiwiZGF0ZSIsIkRhdGUiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJ2YWwiLCJpbWciLCJjb21tZW50cyIsImNvbW1lbnRQcm9wcyIsInBhZ2UiLCJzcGxpdCIsIndheSIsInBhZ2VOdW0iLCJpdGVtIl0sIm1hcHBpbmdzIjoi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d0QsUUFBVSxDQUFFdkQsTUFBT0QsRUFBT0ssS0FBSzJCLE9BQVMsRUFBRzlCLElBQUtGLEVBQU9LLEtBQUsyQixRQUNuRWhDLEVBQU95RCxrQkFBa0Isa0JBQ3pCN0QsT0FBTzhELHlCQUF5QixjQUFlMUQsRUFBT3dELFFBQVMsUUF3Qm5FLElBQUljLEVBQVcsR0FDZixTQUFTdkIsSUFDTGhELEVBQUV1QixJQUFJLDZDQUE4QyxJQUFLakIsSUFDckROLEVBQUUsZ0JBQWdCK0MsS0FBSyxJQUN2QndCLEVBQVcsR0FFWHZFLEVBQUVNLEdBQU1rQixNQUFLLENBQUNDLEVBQU8rQyxLQUViQSxFQUFhcEUsU0FBV0EsR0FDeEJvRSxFQUFhQyxPQUFTdEQsR0FDMUJvRCxFQUFTUCxLQUFLLElBQUlsRSxRQUFRMEUsT0FHOUJ2RSxFQUFPSyxLQUFPaUUsRUFDZHRFLEVBQU93RCxRQUFVLENBQUV2RCxNQUFPLEVBQUdDLElBQUssR0FDbENGLEVBQU95RCxrQkFBa0IsZ0JBQ3pCN0QsT0FBTzhELHlCQUF5QixjQUFlMUQsRUFBT3dELFFBQVMsT0FLdkUsU0FBUzNCLEVBQVl4QixHQUNqQixNQUFNZ0QsRUFBUWhELEVBQUtvRSxNQUFNLElBQ3pCLElBQUkzRCxFQUFRLEdBQ1I0RCxFQUFNLENBQUV6RSxNQUFPLEVBQUdDLElBQUssTUFDdkJ5RSxFQUFVLEVBY2QsT0FYQTdELEVBQU02RCxHQUFXLEdBQ2pCNUUsRUFBRXNELEdBQU85QixNQUFLLENBQUNDLEVBQU9vRCxLQUNkcEQsR0FBU2tELEVBQUl6RSxPQUFTdUIsR0FBU2tELEVBQUl4RSxJQUNuQ1ksRUFBTTZELElBQVlDLEdBR3RCOUQsSUFBUTZELEdBQVcsR0FDbkJELEVBQUl6RSxNQUFReUUsRUFBSXhFLElBQ2hCd0UsRUFBSXhFLEtBQU8sU0FHUlksRUFwQlhpQyIsImZpbGUiOiJjaGFwdGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmltcG9ydCBEcm9wRG93biBmcm9tICcuL0Ryb3BEb3duLm1pbi5qcyc7XHJcbmltcG9ydCBIaWRlSXQgZnJvbSAnLi9IaWRlSXQubWluLmpzJztcclxuaW1wb3J0IFNob3dJdCBmcm9tICcuL1Nob3dJdC5taW4uanMnO1xyXG5pbXBvcnQgQ29tbWVudCBmcm9tICcuL0NvbW1lbnQubWluLmpzJztcclxuaW1wb3J0IFNsaWNlciBmcm9tICcuL1NsaWNlci5taW4uanMnO1xyXG5cclxuJCgoKSA9PiB7XHJcbiAgICBjb25zdCBzbGljZXIgPSBuZXcgU2xpY2VyKFtdLCB7IHN0YXJ0OiAwLCBlbmQ6IDUgfSk7IFxyXG4gICAgY29uc3QgYm9va0lkID0gcGFyc2VJbnQoJCgnYm9keScpLmRhdGEoKS5ib29raWQpO1xyXG5cclxuICAgIC8vIFNNT09USCBTSE9XIC0tLS0+XHJcbiAgICBjb25zdCBzcGlubmVyID0gbmV3IEhpZGVJdCh7XHJcbiAgICAgICAgc2VsZWN0b3I6ICcucnQtbG9hZGVyX19jb250ZW50JyxcclxuICAgICAgICBweDogJzUwcHgnLFxyXG4gICAgICAgIHNlY29uZHM6IDAuNSxcclxuICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xyXG4gICAgICAgICAgICAkKCcucnQtbG9hZGVyJykucmVtb3ZlKCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBibG9ja3MgPSBuZXcgU2hvd0l0KHsgc2VsZWN0b3I6ICdoZWFkZXIsIGZvb3Rlciwgc2VjdGlvbicsIHNlY29uZHM6IDAuNSB9KTtcclxuICAgICAgICAgICAgYmxvY2tzLnNtb290aFNob3coKTsgICAgXHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuICAgIHNwaW5uZXIuc21vb3RoSGlkZVkoKTtcclxuICAgIC8vIDwtLS0tIFNNT09USCBTSE9XXHJcblxyXG4gICAgXHJcbiAgICBsZXQgY3VycmVudFBhZ2UgPSAxO1xyXG4gICAgbGV0IGN1cnJlbnRDaGFwdGVyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NoYXB0ZXJOdW0nKTtcclxuXHJcbiAgICBsZXQgcGFnZXM7XHJcbiAgICBsZXQgY2hhcHRlcnM7XHJcblxyXG4gICAgbGV0IHBhZ2VzQ291bnQ7XHJcbiAgICBsZXQgY2hhcHRlcnNDb3VudDtcclxuXHJcbiAgICAkLmdldCgnLi4vZGF0YWJhc2UvYm9va3MvaW5mb3JtYXRpb24uanNvbicsIHt9LCAoZGF0YSkgPT4ge1xyXG5cclxuICAgICAgICAkKGRhdGEpLmVhY2goKGluZGV4LCBib29rKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChib29rLmlkICE9PSBib29rSWQpIHJldHVyblxyXG4gICAgICAgICAgICBjaGFwdGVycyA9IGJvb2suY2hhcHRlcnM7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgJC5nZXQoYCR7Y2hhcHRlcnNbY3VycmVudENoYXB0ZXJdLmxpbmt9YCwge2RhdGFUeXBlOiBcInRleHRcIn0sIChsaW5rKSA9PiB7XHJcbiAgICAgICAgICAgIHBhZ2VzID0gcmV0dXJuUGFnZXMobGluayk7XHJcblxyXG4gICAgICAgICAgICBwYWdlc0NvdW50ID0gT2JqZWN0LmtleXMocGFnZXMpLmxlbmd0aFxyXG4gICAgICAgICAgICBjaGFwdGVyc0NvdW50ID0gT2JqZWN0LmtleXMoY2hhcHRlcnMpLmxlbmd0aFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZHJvcERvd24oe1xyXG4gICAgICAgICAgICAgICAgZGF0YUF0cjogJ3BhZ2VzJyxcclxuICAgICAgICAgICAgICAgIGJ1dHRvblNpemU6ICdub3JtYWwnLFxyXG4gICAgICAgICAgICAgICAgbGlzdFNpemU6ICcxMDAlJyxcclxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IDAuMixcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAn0KHRgtGA0LDQvdC40YbRiycsXHJcbiAgICAgICAgICAgICAgICBpbnB1dE5hbWU6ICdsaW5rJyxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihkcm9wRG93bikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSAkKCcucnQtZHJvcGRvd25fX2l0ZW0gYnV0dG9uJywgZHJvcERvd24gKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9ucy5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhZ2UgPSBwYXJzZUludCgkKHRoaXMpLnRleHQoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBhZ2UgPiBwYWdlc0NvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gXCJib29rLmh0bWxcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzW2N1cnJlbnRQYWdlXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBwYWdlc0NvdW50KS5jcmVhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIGRyb3BEb3duKHtcclxuICAgICAgICAgICAgICAgIGRhdGFBdHI6ICdjaGFwdGVycycsXHJcbiAgICAgICAgICAgICAgICBjbGFzc2VzOiBbJ3J0LW1yLWRlZmF1bHQnXSxcclxuICAgICAgICAgICAgICAgIGJ1dHRvblNpemU6ICdub3JtYWwnLFxyXG4gICAgICAgICAgICAgICAgbGlzdFNpemU6ICcxMDAlJyxcclxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IDAuMixcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAn0JPQu9Cw0LLRiycsXHJcbiAgICAgICAgICAgICAgICBpbnB1dE5hbWU6ICdsaW5rJyxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihkcm9wRG93bikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSAkKCcucnQtZHJvcGRvd25fX2l0ZW0gYnV0dG9uJywgZHJvcERvd24gKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9ucy5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXB0ZXIgPSBwYXJzZUludCgkKHRoaXMpLnRleHQoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZ2V0KGAke2NoYXB0ZXJzW2N1cnJlbnRDaGFwdGVyXS5saW5rfWAsIHtkYXRhVHlwZTogXCJ0ZXh0XCJ9LCAobGluaykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZXMgPSByZXR1cm5QYWdlcyhsaW5rKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VzQ291bnQgPSBPYmplY3Qua2V5cyhwYWdlcykubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzW2N1cnJlbnRQYWdlXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBjaGFwdGVyc0NvdW50KS5jcmVhdGUoKTtcclxuXHJcbiAgICAgICAgICAgICQoJy5ydC1wYWdlX190ZXh0JykuaHRtbChwYWdlc1tjdXJyZW50UGFnZV0pO1xyXG4gICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1wYWdlJykuaHRtbChg0KHRgtGA0LDQvdC40YbQsCAke2N1cnJlbnRQYWdlfWApO1xyXG4gICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1jaGFwdGVyJykuaHRtbChg0JPQu9Cw0LLQsCAke2N1cnJlbnRDaGFwdGVyfWApO1xyXG4gICAgICAgIH0pXHJcbiBcclxuICAgIH0pXHJcblxyXG5cclxuICAgIC8vIEJVVFRPTiBORVhUIFBBR0UgLS0tPlxyXG4gICAgJCgnYnV0dG9uI25leHQtcGFnZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChjdXJyZW50UGFnZSA+PSBwYWdlc0NvdW50KSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBcImJvb2suaHRtbFwiO1xyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICQoJy5ydC1wYWdlX190ZXh0JykuaHRtbChwYWdlc1srK2N1cnJlbnRQYWdlXSlcclxuICAgICAgICAkKCcucnQtcGFnZV9faW5mby1wYWdlJykuaHRtbChg0KHRgtGA0LDQvdC40YbQsCAke2N1cnJlbnRQYWdlfWApO1xyXG4gICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcblxyXG4gICAgICAgIHVwZGF0ZUNvbW1lbnRzKCk7XHJcbiAgICB9KVxyXG4gICAgLy8gPC0tLS0gQlVUVE9OIE5FWFQgUEFHRVxyXG5cclxuXHJcbiAgICAvLyBCVVRUT04gTEFTVCBQQUdFIC0tLT5cclxuICAgICQoJ2J1dHRvbiNsYXN0LXBhZ2UnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFBhZ2UgPT09IDEpIHtcclxuICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IFwiYm9vay5odG1sXCI7XHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzWy0tY3VycmVudFBhZ2VdKVxyXG4gICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tY2hhcHRlcicpLmh0bWwoYNCT0LvQsNCy0LAgJHtjdXJyZW50Q2hhcHRlcn1gKTtcclxuXHJcbiAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgIH0pXHJcbiAgICAvLyA8LS0tLSBCVVRUT04gTEFTVCBQQUdFXHJcblxyXG5cclxuICAgIC8vIFNIT1cgTU9SRSBDT01NRU5UUyAtLS0tPlxyXG4gICAgbGV0IGFsbFNob3dlZCA9IGZhbHNlO1xyXG4gICAgJCgnYnV0dG9uI3Nob3ctbW9yZS1jb21tZW50cycpLm9uKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICBzbGljZXIuaW5kZXhlcyA9IHsgc3RhcnQ6IHNsaWNlci5pbmRleGVzLmVuZCwgZW5kOiBzbGljZXIuaW5kZXhlcy5lbmQgKyA1IH07XHJcbiAgICAgICAgc2xpY2VyLmFkZFNsaWNlZENvbW1lbnRzKCcucnQtY29tbWVudHMnKTtcclxuICAgICAgICBTaG93SXQuc21vb3RoU2hvd1NsaWNlZEVsZW1lbnRzKCcucnQtY29tbWVudCcsIHNsaWNlci5pbmRleGVzLCAwLjUpO1xyXG5cclxuICAgICAgICBpZiAoc2xpY2VyLmluZGV4ZXMuZW5kIDw9IHNsaWNlci5kYXRhLmxlbmd0aCkgcmV0dXJuXHJcbiAgICAgICAgYWxsU2hvd2VkID0gdHJ1ZTsgICBcclxuICAgIH0pXHJcbiAgICAvLyA8LS0tLSBTSE9XIE1PUkUgQ09NTUVOVFNcclxuXHJcblxyXG4gICAgLy8gVEVYVEFSRUEgLS0tLT5cclxuICAgIENvbW1lbnQuZHluYW1pY1RleHRhcmVhSGVpZ2h0KCk7XHJcbiAgICAkKCcjbWFpbi10ZXh0YXJlYScpLm9uKCdzdWJtaXQnLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRleHRhcmVhID0gJCgndGV4dGFyZWEnLCAkKHRoaXMpKTtcclxuICAgICAgICBcclxuICAgICAgICBzbGljZXIuZGF0YS5wdXNoKG5ldyBDb21tZW50KHtcclxuICAgICAgICAgICAgbmFtZTogJ9CT0L7RgdGC0YwnLFxyXG4gICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpLFxyXG4gICAgICAgICAgICB0ZXh0OiAkKHRleHRhcmVhKS52YWwoKSxcclxuICAgICAgICAgICAgaW1nOiAnLi9pbWFnZXMvdXNlci1pbWFnZS5qcGcnXHJcbiAgICAgICAgfSkpXHJcbiAgICAgICAgdGV4dGFyZWEudmFsKCcnKTtcclxuXHJcbiAgICAgICAgaWYgKHNsaWNlci5pbmRleGVzLmVuZCA+PSBzbGljZXIuZGF0YS5sZW5ndGgpIGFsbFNob3dlZCA9IHRydWU7ICAgXHJcbiAgICAgICAgaWYgKCAhIGFsbFNob3dlZCkgcmV0dXJuXHJcblxyXG4gICAgICAgIHNsaWNlci5pbmRleGVzID0geyBzdGFydDogc2xpY2VyLmRhdGEubGVuZ3RoIC0gMSwgZW5kOiBzbGljZXIuZGF0YS5sZW5ndGggfTtcclxuICAgICAgICBzbGljZXIuYWRkU2xpY2VkQ29tbWVudHMoJyNtYWluLWNvbW1lbnRzJyk7XHJcbiAgICAgICAgU2hvd0l0LnNtb290aFNob3dTbGljZWRFbGVtZW50cygnLnJ0LWNvbW1lbnQnLCBzbGljZXIuaW5kZXhlcywgMC41KTtcclxuICAgIH0pXHJcbiAgICAvLyA8LS0tLSBURVhUQVJFQVxyXG5cclxuXHJcbiAgICAvLyBIRUxQRVIgRlVOQ1RJT05TIC0tLS0+XHJcbiAgICBmdW5jdGlvbiBkcm9wRG93bihwcm9wcywgY291bnQpIHtcclxuICAgICAgICBjb25zdCBhcnJheSA9IFtdO1xyXG4gICAgICAgIGxldCBpID0gMTtcclxuICAgICAgICBmb3IoaTsgaSA8PSBjb3VudDsgaSsrKSB7IGFycmF5W2kgLSAxXSA9IGkgfTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gbmV3IERyb3BEb3duKHtcclxuICAgICAgICAgICAgZGF0YUF0cjogcHJvcHMuZGF0YUF0cixcclxuICAgICAgICAgICAgY2xhc3NlczogcHJvcHMuY2xhc3NlcyxcclxuICAgICAgICAgICAgYnV0dG9uU2l6ZTogcHJvcHMuYnV0dG9uU2l6ZSxcclxuICAgICAgICAgICAgbGlzdFNpemU6IHByb3BzLmxpc3RTaXplLFxyXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiBwcm9wcy50cmFuc2l0aW9uLFxyXG4gICAgICAgICAgICB0aXRsZTogcHJvcHMudGl0bGUsXHJcbiAgICAgICAgICAgIGlucHV0TmFtZTogcHJvcHMuaW5wdXROYW1lLFxyXG4gICAgICAgICAgICBjYWxsYmFjazogcHJvcHMuY2FsbGJhY2ssXHJcbiAgICAgICAgICAgIGxpc3Q6IGFycmF5XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBsZXQgY29tbWVudHMgPSBbXTtcclxuICAgIGZ1bmN0aW9uIHVwZGF0ZUNvbW1lbnRzKCkge1xyXG4gICAgICAgICQuZ2V0KCcuLi9kYXRhYmFzZS9jb21tZW50cy9jaGFwdGVyLWNvbW1lbnRzLmpzb24nLCB7fSwgKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgJCgnLnJ0LWNvbW1lbnRzJykuaHRtbCgnJyk7XHJcbiAgICAgICAgICAgIGNvbW1lbnRzID0gW107XHJcblxyXG4gICAgICAgICAgICAkKGRhdGEpLmVhY2goKGluZGV4LCBjb21tZW50UHJvcHMpID0+IHtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbW1lbnRQcm9wcy5ib29rSWQgIT09IGJvb2tJZCkgcmV0dXJuXHJcbiAgICAgICAgICAgICAgICBpZiAoY29tbWVudFByb3BzLnBhZ2UgIT09IGN1cnJlbnRQYWdlKSByZXR1cm5cclxuICAgICAgICAgICAgICAgIGNvbW1lbnRzLnB1c2gobmV3IENvbW1lbnQoY29tbWVudFByb3BzKSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICBcclxuICAgICAgICAgICAgc2xpY2VyLmRhdGEgPSBjb21tZW50cztcclxuICAgICAgICAgICAgc2xpY2VyLmluZGV4ZXMgPSB7IHN0YXJ0OiAwLCBlbmQ6IDUgfTtcclxuICAgICAgICAgICAgc2xpY2VyLmFkZFNsaWNlZENvbW1lbnRzKCcucnQtY29tbWVudHMnKTtcclxuICAgICAgICAgICAgU2hvd0l0LnNtb290aFNob3dTbGljZWRFbGVtZW50cygnLnJ0LWNvbW1lbnQnLCBzbGljZXIuaW5kZXhlcywgMC41KTsgXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIHVwZGF0ZUNvbW1lbnRzKCk7XHJcblxyXG4gICAgZnVuY3Rpb24gcmV0dXJuUGFnZXMoZGF0YSkge1xyXG4gICAgICAgIGNvbnN0IGFycmF5ID0gZGF0YS5zcGxpdCgnJyk7XHJcbiAgICAgICAgbGV0IHBhZ2VzID0ge307XHJcbiAgICAgICAgbGV0IHdheSA9IHsgc3RhcnQ6IDAsIGVuZDogMzExNX07XHJcbiAgICAgICAgbGV0IHBhZ2VOdW0gPSAxO1xyXG5cclxuXHJcbiAgICAgICAgcGFnZXNbcGFnZU51bV0gPSBbXTtcclxuICAgICAgICAkKGFycmF5KS5lYWNoKChpbmRleCwgaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggPj0gd2F5LnN0YXJ0ICYmIGluZGV4IDw9IHdheS5lbmQpIHtcclxuICAgICAgICAgICAgICAgIHBhZ2VzW3BhZ2VOdW1dICs9IGl0ZW07XHJcbiAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwYWdlc1srK3BhZ2VOdW1dID0gW107XHJcbiAgICAgICAgICAgIHdheS5zdGFydCA9IHdheS5lbmQ7XHJcbiAgICAgICAgICAgIHdheS5lbmQgKz0gMzExNTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBwYWdlcyBcclxuICAgIH1cclxuICAgIC8vIDwtLS0tIEhFTFBFUiBGVU5DVElPTlNcclxuXHJcbn0pIl19
