"use strict";import DropDown from"./DropDown.min.js";import HideIt from"./HideIt.min.js";import ShowIt from"./ShowIt.min.js";import Comment from"./Comment.min.js";import Slicer from"./Slicer.min.js";import Modal from"./Modal.min.js";$((()=>{const t=new Slicer([],{start:0,end:5}),e=parseInt($("body").data().bookid);new HideIt({selector:".rt-loader__content",px:"50px",seconds:.5,callback:()=>{$(".rt-loader").remove();new ShowIt({selector:"header, footer, section",seconds:.5}).smoothShow()}}).smoothHideY();let n,o,a,i,m=1,r=1;function s(t,e){const n=[];let o=1;for(;o<=e;o++)n[o-1]=o;return new DropDown({dataAtr:t.dataAtr,classes:t.classes,buttonSize:t.buttonSize,listSize:t.listSize,transition:t.transition,title:t.title,inputName:t.inputName,callback:t.callback,list:n})}$.get("../database/books/information.json",{},(t=>{$(t).each(((t,n)=>{n.id===e&&(o=n.chapters)})),$.get(`${o[r].link}`,{dataType:"text"},(t=>{n=h(t),a=Object.keys(n).length,i=Object.keys(o).length,s({dataAtr:"pages",buttonSize:"normal",listSize:"100%",transition:.2,title:"Страница",inputName:"link",callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){m=parseInt($(this).text()),m>a?document.location.href="book.html":($(".rt-page__text").html(n[m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`),d())}))}},a).create(),s({dataAtr:"chapters",classes:["rt-mr-default"],buttonSize:"normal",listSize:"100%",transition:.2,title:"Главы",inputName:"link",callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){r=parseInt($(this).text()),m=1,$.get(`${o[r].link}`,{dataType:"text"},(t=>{n=h(t),a=Object.keys(n).length})),$(".rt-page__text").html(n[m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`),d()}))}},i).create(),$(".rt-page__text").html(n[m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`)}))})),$("button#next-page").on("click",(function(){m>=a?document.location.href="book.html":($(".rt-page__text").html(n[++m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`),d())})),$("button#last-page").on("click",(function(){1!==m?($(".rt-page__text").html(n[--m]),$(".rt-page__info-page").html(`Страница ${m}`),$(".rt-page__info-chapter").html(`Глава ${r}`),d()):document.location.href="book.html"}));let l=[],c=!1;function d(){$.get("../database/comments/chapter-comments.json",{},(n=>{$(".rt-comments").html(""),l=[],$(n).each(((t,n)=>{n.bookId===e&&n.page===m&&l.push(new Comment(n))})),t.data=l,t.indexes={start:0,end:5},t.addSlicedComments(".rt-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5)}))}function h(t){const e=t.split("");let n={},o={start:0,end:3115},a=1;return n[a]=[],$(e).each(((t,e)=>{t>=o.start&&t<=o.end?n[a]+=e:(n[++a]=[],o.start=o.end,o.end+=3115)})),n}d(),$("button#show-more-comments").on("click",(()=>{t.indexes={start:t.indexes.end,end:t.indexes.end+5},t.addSlicedComments(".rt-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5),t.indexes.end<=t.data.length||(c=!0)})),Comment.dynamicTextareaHeight(),$("#main-textarea").on("submit",(function(e){e.preventDefault();const n=$("textarea",$(this));t.data.push(new Comment({name:"Александр",date:(new Date).toLocaleDateString(),text:$(n).val(),img:"./images/user-image.jpg"})),n.val(""),t.indexes.end>=t.data.length&&(c=!0),c&&(t.indexes={start:t.data.length-1,end:t.data.length},t.addSlicedComments("#main-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5))}))}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXB0ZXIubWluLmpzIl0sIm5hbWVzIjpbIkRyb3BEb3duIiwiSGlkZUl0IiwiU2hvd0l0IiwiQ29tbWVudCIsIlNsaWNlciIsIk1vZGFsIiwiJCIsInNsaWNlciIsInN0YXJ0IiwiZW5kIiwiYm9va0lkIiwicGFyc2VJbnQiLCJkYXRhIiwiYm9va2lkIiwic2VsZWN0b3IiLCJweCIsInNlY29uZHMiLCJjYWxsYmFjayIsInJlbW92ZSIsInNtb290aFNob3ciLCJzbW9vdGhIaWRlWSIsInBhZ2VzIiwiY2hhcHRlcnMiLCJwYWdlc0NvdW50IiwiY2hhcHRlcnNDb3VudCIsImN1cnJlbnRQYWdlIiwiY3VycmVudENoYXB0ZXIiLCJkcm9wRG93biIsInByb3BzIiwiY291bnQiLCJhcnJheSIsImkiLCJkYXRhQXRyIiwiY2xhc3NlcyIsImJ1dHRvblNpemUiLCJsaXN0U2l6ZSIsInRyYW5zaXRpb24iLCJ0aXRsZSIsImlucHV0TmFtZSIsImxpc3QiLCJnZXQiLCJlYWNoIiwiaW5kZXgiLCJib29rIiwiaWQiLCJsaW5rIiwiZGF0YVR5cGUiLCJyZXR1cm5QYWdlcyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJvbiIsInRoaXMiLCJ0ZXh0IiwiZG9jdW1lbnQiLCJsb2NhdGlvbiIsImhyZWYiLCJodG1sIiwidXBkYXRlQ29tbWVudHMiLCJjcmVhdGUiLCJjb21tZW50cyIsImFsbFNob3dlZCIsImNvbW1lbnRQcm9wcyIsInBhZ2UiLCJwdXNoIiwiaW5kZXhlcyIsImFkZFNsaWNlZENvbW1lbnRzIiwic21vb3RoU2hvd1NsaWNlZEVsZW1lbnRzIiwic3BsaXQiLCJ3YXkiLCJwYWdlTnVtIiwiaXRlbSIsImR5bmFtaWNUZXh0YXJlYUhlaWdodCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ0ZXh0YXJlYSIsIm5hbWUiLCJkYXRlIiwiRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsInZhbCIsImltZyJdLCJtYXBwaW5ncyI6IkFBQUEsb0JBRU9BLGFBQWMs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LEdBQVMyQixFQUFJNUQsSUFDbkNZLEVBQU1pRCxJQUFZQyxHQUd0QmxELElBQVFpRCxHQUFXLEdBQ25CRCxFQUFJN0QsTUFBUTZELEVBQUk1RCxJQUNoQjRELEVBQUk1RCxLQUFPLFNBR1JZLEVBcEJYcUMsSUF1QkFwRCxFQUFFLDZCQUE2QjZDLEdBQUcsU0FBUyxLQUN2QzVDLEVBQU8wRCxRQUFVLENBQUV6RCxNQUFPRCxFQUFPMEQsUUFBUXhELElBQUtBLElBQUtGLEVBQU8wRCxRQUFReEQsSUFBTSxHQUN4RUYsRUFBTzJELGtCQUFrQixnQkFDekJoRSxPQUFPaUUseUJBQXlCLGNBQWU1RCxFQUFPMEQsUUFBUyxJQUUzRDFELEVBQU8wRCxRQUFReEQsS0FBT0YsRUFBT0ssS0FBS3NDLFNBQ3RDVyxHQUFZLE1BSWhCMUQsUUFBUXFFLHdCQUNSbEUsRUFBRSxrQkFBa0I2QyxHQUFHLFVBQVUsU0FBU3NCLEdBQ3RDQSxFQUFNQyxpQkFFTixNQUFNQyxFQUFXckUsRUFBRSxXQUFZQSxFQUFFOEMsT0FFakM3QyxFQUFPSyxLQUFLb0QsS0FBSyxJQUFJN0QsUUFBUSxDQUN6QnlFLEtBQU0sWUFDTkMsTUFBTSxJQUFJQyxNQUFPQyxxQkFDakIxQixLQUFNL0MsRUFBRXFFLEdBQVVLLE1BQ2xCQyxJQUFLLDZCQUVUTixFQUFTSyxJQUFJLElBRVR6RSxFQUFPMEQsUUFBUXhELEtBQU9GLEVBQU9LLEtBQUtzQyxTQUFRVyxHQUFZLEdBQ25EQSxJQUVQdEQsRUFBTzBELFFBQVUsQ0FBRXpELE1BQU9ELEVBQU9LLEtBQUtzQyxPQUFTLEVBQUd6QyxJQUFLRixFQUFPSyxLQUFLc0MsUUFDbkUzQyxFQUFPMkQsa0JBQWtCLGtCQUN6QmhFLE9BQU9pRSx5QkFBeUIsY0FBZTVELEVBQU8wRCxRQUFTIiwiZmlsZSI6ImNoYXB0ZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IERyb3BEb3duIGZyb20gJy4vRHJvcERvd24ubWluLmpzJztcclxuaW1wb3J0IEhpZGVJdCBmcm9tICcuL0hpZGVJdC5taW4uanMnO1xyXG5pbXBvcnQgU2hvd0l0IGZyb20gJy4vU2hvd0l0Lm1pbi5qcyc7XHJcbmltcG9ydCBDb21tZW50IGZyb20gJy4vQ29tbWVudC5taW4uanMnO1xyXG5pbXBvcnQgU2xpY2VyIGZyb20gJy4vU2xpY2VyLm1pbi5qcyc7XHJcbmltcG9ydCBNb2RhbCBmcm9tICcuL01vZGFsLm1pbi5qcyc7XHJcblxyXG4kKCgpID0+IHtcclxuICAgIGNvbnN0IHNsaWNlciA9IG5ldyBTbGljZXIoW10sIHsgc3RhcnQ6IDAsIGVuZDogNSB9KTsgXHJcbiAgICBjb25zdCBib29rSWQgPSBwYXJzZUludCgkKCdib2R5JykuZGF0YSgpLmJvb2tpZCk7XHJcblxyXG4gICAgLy8gU01PT1RIIFNIT1cgLS0tLT5cclxuICAgIGNvbnN0IHNwaW5uZXIgPSBuZXcgSGlkZUl0KHtcclxuICAgICAgICBzZWxlY3RvcjogJy5ydC1sb2FkZXJfX2NvbnRlbnQnLFxyXG4gICAgICAgIHB4OiAnNTBweCcsXHJcbiAgICAgICAgc2Vjb25kczogMC41LFxyXG4gICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICQoJy5ydC1sb2FkZXInKS5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGJsb2NrcyA9IG5ldyBTaG93SXQoeyBzZWxlY3RvcjogJ2hlYWRlciwgZm9vdGVyLCBzZWN0aW9uJywgc2Vjb25kczogMC41IH0pO1xyXG4gICAgICAgICAgICBibG9ja3Muc21vb3RoU2hvdygpOyAgICBcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgc3Bpbm5lci5zbW9vdGhIaWRlWSgpO1xyXG4gICAgLy8gPC0tLS0gU01PT1RIIFNIT1dcclxuXHJcbiAgICBcclxuXHJcbiAgICBsZXQgY3VycmVudFBhZ2UgPSAxO1xyXG4gICAgbGV0IGN1cnJlbnRDaGFwdGVyID0gMTtcclxuXHJcbiAgICBsZXQgcGFnZXM7XHJcbiAgICBsZXQgY2hhcHRlcnM7XHJcblxyXG4gICAgbGV0IHBhZ2VzQ291bnQ7XHJcbiAgICBsZXQgY2hhcHRlcnNDb3VudDtcclxuXHJcbiAgICAkLmdldCgnLi4vZGF0YWJhc2UvYm9va3MvaW5mb3JtYXRpb24uanNvbicsIHt9LCAoZGF0YSkgPT4ge1xyXG5cclxuICAgICAgICAkKGRhdGEpLmVhY2goKGluZGV4LCBib29rKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChib29rLmlkICE9PSBib29rSWQpIHJldHVyblxyXG4gICAgICAgICAgICBjaGFwdGVycyA9IGJvb2suY2hhcHRlcnM7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgJC5nZXQoYCR7Y2hhcHRlcnNbY3VycmVudENoYXB0ZXJdLmxpbmt9YCwge2RhdGFUeXBlOiBcInRleHRcIn0sIChsaW5rKSA9PiB7XHJcbiAgICAgICAgICAgIHBhZ2VzID0gcmV0dXJuUGFnZXMobGluayk7XHJcblxyXG4gICAgICAgICAgICBwYWdlc0NvdW50ID0gT2JqZWN0LmtleXMocGFnZXMpLmxlbmd0aFxyXG4gICAgICAgICAgICBjaGFwdGVyc0NvdW50ID0gT2JqZWN0LmtleXMoY2hhcHRlcnMpLmxlbmd0aFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZHJvcERvd24oe1xyXG4gICAgICAgICAgICAgICAgZGF0YUF0cjogJ3BhZ2VzJyxcclxuICAgICAgICAgICAgICAgIGJ1dHRvblNpemU6ICdub3JtYWwnLFxyXG4gICAgICAgICAgICAgICAgbGlzdFNpemU6ICcxMDAlJyxcclxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IDAuMixcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAn0KHRgtGA0LDQvdC40YbQsCcsXHJcbiAgICAgICAgICAgICAgICBpbnB1dE5hbWU6ICdsaW5rJyxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihkcm9wRG93bikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSAkKCcucnQtZHJvcGRvd25fX2l0ZW0gYnV0dG9uJywgZHJvcERvd24gKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9ucy5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhZ2UgPSBwYXJzZUludCgkKHRoaXMpLnRleHQoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBhZ2UgPiBwYWdlc0NvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gXCJib29rLmh0bWxcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzW2N1cnJlbnRQYWdlXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBwYWdlc0NvdW50KS5jcmVhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIGRyb3BEb3duKHtcclxuICAgICAgICAgICAgICAgIGRhdGFBdHI6ICdjaGFwdGVycycsXHJcbiAgICAgICAgICAgICAgICBjbGFzc2VzOiBbJ3J0LW1yLWRlZmF1bHQnXSxcclxuICAgICAgICAgICAgICAgIGJ1dHRvblNpemU6ICdub3JtYWwnLFxyXG4gICAgICAgICAgICAgICAgbGlzdFNpemU6ICcxMDAlJyxcclxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IDAuMixcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAn0JPQu9Cw0LLRiycsXHJcbiAgICAgICAgICAgICAgICBpbnB1dE5hbWU6ICdsaW5rJyxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihkcm9wRG93bikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSAkKCcucnQtZHJvcGRvd25fX2l0ZW0gYnV0dG9uJywgZHJvcERvd24gKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9ucy5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXB0ZXIgPSBwYXJzZUludCgkKHRoaXMpLnRleHQoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZ2V0KGAke2NoYXB0ZXJzW2N1cnJlbnRDaGFwdGVyXS5saW5rfWAsIHtkYXRhVHlwZTogXCJ0ZXh0XCJ9LCAobGluaykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZXMgPSByZXR1cm5QYWdlcyhsaW5rKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VzQ291bnQgPSBPYmplY3Qua2V5cyhwYWdlcykubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzW2N1cnJlbnRQYWdlXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBjaGFwdGVyc0NvdW50KS5jcmVhdGUoKTtcclxuXHJcbiAgICAgICAgICAgICQoJy5ydC1wYWdlX190ZXh0JykuaHRtbChwYWdlc1tjdXJyZW50UGFnZV0pO1xyXG4gICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1wYWdlJykuaHRtbChg0KHRgtGA0LDQvdC40YbQsCAke2N1cnJlbnRQYWdlfWApO1xyXG4gICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1jaGFwdGVyJykuaHRtbChg0JPQu9Cw0LLQsCAke2N1cnJlbnRDaGFwdGVyfWApO1xyXG4gICAgICAgIH0pXHJcbiBcclxuICAgIH0pXHJcblxyXG5cclxuICAgIC8vIEJVVFRPTiBORVhUIFBBR0UgLS0tPlxyXG4gICAgJCgnYnV0dG9uI25leHQtcGFnZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChjdXJyZW50UGFnZSA+PSBwYWdlc0NvdW50KSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBcImJvb2suaHRtbFwiO1xyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgICQoJy5ydC1wYWdlX190ZXh0JykuaHRtbChwYWdlc1srK2N1cnJlbnRQYWdlXSlcclxuICAgICAgICAkKCcucnQtcGFnZV9faW5mby1wYWdlJykuaHRtbChg0KHRgtGA0LDQvdC40YbQsCAke2N1cnJlbnRQYWdlfWApO1xyXG4gICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcblxyXG4gICAgICAgIHVwZGF0ZUNvbW1lbnRzKCk7XHJcbiAgICB9KVxyXG4gICAgLy8gPC0tLS0gQlVUVE9OIE5FWFQgUEFHRVxyXG5cclxuXHJcbiAgICAvLyBCVVRUT04gTEFTVCBQQUdFIC0tLT5cclxuICAgICQoJ2J1dHRvbiNsYXN0LXBhZ2UnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFBhZ2UgPT09IDEpIHtcclxuICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IFwiYm9vay5odG1sXCI7XHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzWy0tY3VycmVudFBhZ2VdKVxyXG4gICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tY2hhcHRlcicpLmh0bWwoYNCT0LvQsNCy0LAgJHtjdXJyZW50Q2hhcHRlcn1gKTtcclxuXHJcbiAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgIH0pXHJcbiAgICAvLyA8LS0tLSBCVVRUT04gTEFTVCBQQUdFXHJcblxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBkcm9wRG93bihwcm9wcywgY291bnQpIHtcclxuICAgICAgICBjb25zdCBhcnJheSA9IFtdO1xyXG4gICAgICAgIGxldCBpID0gMTtcclxuICAgICAgICBmb3IoaTsgaSA8PSBjb3VudDsgaSsrKSB7IGFycmF5W2kgLSAxXSA9IGkgfTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gbmV3IERyb3BEb3duKHtcclxuICAgICAgICAgICAgZGF0YUF0cjogcHJvcHMuZGF0YUF0cixcclxuICAgICAgICAgICAgY2xhc3NlczogcHJvcHMuY2xhc3NlcyxcclxuICAgICAgICAgICAgYnV0dG9uU2l6ZTogcHJvcHMuYnV0dG9uU2l6ZSxcclxuICAgICAgICAgICAgbGlzdFNpemU6IHByb3BzLmxpc3RTaXplLFxyXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiBwcm9wcy50cmFuc2l0aW9uLFxyXG4gICAgICAgICAgICB0aXRsZTogcHJvcHMudGl0bGUsXHJcbiAgICAgICAgICAgIGlucHV0TmFtZTogcHJvcHMuaW5wdXROYW1lLFxyXG4gICAgICAgICAgICBjYWxsYmFjazogcHJvcHMuY2FsbGJhY2ssXHJcbiAgICAgICAgICAgIGxpc3Q6IGFycmF5XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIFxyXG5cclxuXHJcbiAgICBsZXQgY29tbWVudHMgPSBbXTtcclxuICAgIGxldCBhbGxTaG93ZWQgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gdXBkYXRlQ29tbWVudHMoKSB7XHJcbiAgICAgICAgJC5nZXQoJy4uL2RhdGFiYXNlL2NvbW1lbnRzL2NoYXB0ZXItY29tbWVudHMuanNvbicsIHt9LCAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAkKCcucnQtY29tbWVudHMnKS5odG1sKCcnKTtcclxuICAgICAgICAgICAgY29tbWVudHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICQoZGF0YSkuZWFjaCgoaW5kZXgsIGNvbW1lbnRQcm9wcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoY29tbWVudFByb3BzLmJvb2tJZCAhPT0gYm9va0lkKSByZXR1cm5cclxuICAgICAgICAgICAgICAgIGlmIChjb21tZW50UHJvcHMucGFnZSAhPT0gY3VycmVudFBhZ2UpIHJldHVyblxyXG4gICAgICAgICAgICAgICAgY29tbWVudHMucHVzaChuZXcgQ29tbWVudChjb21tZW50UHJvcHMpKTtcclxuICAgICAgICAgICAgfSlcclxuICAgIFxyXG4gICAgICAgICAgICBzbGljZXIuZGF0YSA9IGNvbW1lbnRzO1xyXG4gICAgICAgICAgICBzbGljZXIuaW5kZXhlcyA9IHsgc3RhcnQ6IDAsIGVuZDogNSB9O1xyXG4gICAgICAgICAgICBzbGljZXIuYWRkU2xpY2VkQ29tbWVudHMoJy5ydC1jb21tZW50cycpO1xyXG4gICAgICAgICAgICBTaG93SXQuc21vb3RoU2hvd1NsaWNlZEVsZW1lbnRzKCcucnQtY29tbWVudCcsIHNsaWNlci5pbmRleGVzLCAwLjUpOyBcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgdXBkYXRlQ29tbWVudHMoKTtcclxuXHJcbiAgICBmdW5jdGlvbiByZXR1cm5QYWdlcyhkYXRhKSB7XHJcbiAgICAgICAgY29uc3QgYXJyYXkgPSBkYXRhLnNwbGl0KCcnKTtcclxuICAgICAgICBsZXQgcGFnZXMgPSB7fTtcclxuICAgICAgICBsZXQgd2F5ID0geyBzdGFydDogMCwgZW5kOiAzMTE1fTtcclxuICAgICAgICBsZXQgcGFnZU51bSA9IDE7XHJcblxyXG5cclxuICAgICAgICBwYWdlc1twYWdlTnVtXSA9IFtdO1xyXG4gICAgICAgICQoYXJyYXkpLmVhY2goKGluZGV4LCBpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA+PSB3YXkuc3RhcnQgJiYgaW5kZXggPD0gd2F5LmVuZCkge1xyXG4gICAgICAgICAgICAgICAgcGFnZXNbcGFnZU51bV0gKz0gaXRlbTtcclxuICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBhZ2VzWysrcGFnZU51bV0gPSBbXTtcclxuICAgICAgICAgICAgd2F5LnN0YXJ0ID0gd2F5LmVuZDtcclxuICAgICAgICAgICAgd2F5LmVuZCArPSAzMTE1O1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHBhZ2VzIFxyXG4gICAgfVxyXG5cclxuICAgICQoJ2J1dHRvbiNzaG93LW1vcmUtY29tbWVudHMnKS5vbignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgc2xpY2VyLmluZGV4ZXMgPSB7IHN0YXJ0OiBzbGljZXIuaW5kZXhlcy5lbmQsIGVuZDogc2xpY2VyLmluZGV4ZXMuZW5kICsgNSB9O1xyXG4gICAgICAgIHNsaWNlci5hZGRTbGljZWRDb21tZW50cygnLnJ0LWNvbW1lbnRzJyk7XHJcbiAgICAgICAgU2hvd0l0LnNtb290aFNob3dTbGljZWRFbGVtZW50cygnLnJ0LWNvbW1lbnQnLCBzbGljZXIuaW5kZXhlcywgMC41KTtcclxuXHJcbiAgICAgICAgaWYgKHNsaWNlci5pbmRleGVzLmVuZCA8PSBzbGljZXIuZGF0YS5sZW5ndGgpIHJldHVyblxyXG4gICAgICAgIGFsbFNob3dlZCA9IHRydWU7ICAgXHJcbiAgICB9KVxyXG5cclxuXHJcbiAgICBDb21tZW50LmR5bmFtaWNUZXh0YXJlYUhlaWdodCgpO1xyXG4gICAgJCgnI21haW4tdGV4dGFyZWEnKS5vbignc3VibWl0JywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICBjb25zdCB0ZXh0YXJlYSA9ICQoJ3RleHRhcmVhJywgJCh0aGlzKSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc2xpY2VyLmRhdGEucHVzaChuZXcgQ29tbWVudCh7XHJcbiAgICAgICAgICAgIG5hbWU6ICfQkNC70LXQutGB0LDQvdC00YAnLFxyXG4gICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpLFxyXG4gICAgICAgICAgICB0ZXh0OiAkKHRleHRhcmVhKS52YWwoKSxcclxuICAgICAgICAgICAgaW1nOiAnLi9pbWFnZXMvdXNlci1pbWFnZS5qcGcnXHJcbiAgICAgICAgfSkpXHJcbiAgICAgICAgdGV4dGFyZWEudmFsKCcnKTtcclxuXHJcbiAgICAgICAgaWYgKHNsaWNlci5pbmRleGVzLmVuZCA+PSBzbGljZXIuZGF0YS5sZW5ndGgpIGFsbFNob3dlZCA9IHRydWU7ICAgXHJcbiAgICAgICAgaWYgKCAhIGFsbFNob3dlZCkgcmV0dXJuXHJcblxyXG4gICAgICAgIHNsaWNlci5pbmRleGVzID0geyBzdGFydDogc2xpY2VyLmRhdGEubGVuZ3RoIC0gMSwgZW5kOiBzbGljZXIuZGF0YS5sZW5ndGggfTtcclxuICAgICAgICBzbGljZXIuYWRkU2xpY2VkQ29tbWVudHMoJyNtYWluLWNvbW1lbnRzJyk7XHJcbiAgICAgICAgU2hvd0l0LnNtb290aFNob3dTbGljZWRFbGVtZW50cygnLnJ0LWNvbW1lbnQnLCBzbGljZXIuaW5kZXhlcywgMC41KTtcclxuICAgIH0pXHJcbn0pIl19
