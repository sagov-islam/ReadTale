"use strict";import DropDown from"./DropDown.min.js";import HideIt from"./HideIt.min.js";import ShowIt from"./ShowIt.min.js";import Comment from"./Comment.min.js";import Slicer from"./Slicer.min.js";$((()=>{const t=new Slicer([],{start:0,end:5}),e=+localStorage.getItem("currentBookId");new HideIt({selector:".rt-loader__content",px:"50px",seconds:.5,callback:()=>{$(".rt-loader").remove();new ShowIt({selector:"header, footer, section",seconds:.5}).smoothShow()}}).smoothHideY();let n,o,a,i,r=1,m=localStorage.getItem("chapterNum");$.get("../database/books/information.json",{},(t=>{$(t).each(((t,n)=>{n.id===e&&(o=n.chapters)})),$.get(`${o[m].link}`,{dataType:"text"},(t=>{n=p(t),a=Object.keys(n).length,i=Object.keys(o).length;const e=[];let l=1;for(;l<=a;l++)e[l-1]=l;new DropDown({dataAtr:"pages",buttonSize:"normal",listSize:"100%",transition:.2,title:"Страницы",inputName:"link",list:c(a),callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){r=parseInt($(this).text()),r>a?document.location.href="book.html":($(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h())}))}}).create(),new DropDown({dataAtr:"chapters",classes:["rt-mr-default"],buttonSize:"normal",listSize:"100%",transition:.2,title:"Главы",inputName:"link",list:c(i),callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){m=parseInt($(this).text()),r=1,$.get(`${o[m].link}`,{dataType:"text"},(t=>{n=p(t),a=Object.keys(n).length,$(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h(),s()}))}))}}).create(),$(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`)}))})),$("button#next-page").on("click",(function(){if(r>=a){if(o[++m])return void g();document.location.href="book.html"}$(".rt-page__text").html(n[++r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h()})),$("button#last-page").on("click",(function(){if(1===r){if(o[--m])return void g();document.location.href="book.html"}$(".rt-page__text").html(n[--r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h()}));let l=!1;function c(t){const e=[];for(let n=1;n<=t;n++)e[n-1]=n;return e}function s(){$('[data-dropdown="pages"]').html(""),new DropDown({dataAtr:"pages",buttonSize:"normal",listSize:"100%",transition:.2,title:"Страницы",inputName:"link",list:c(a),callback:function(t){$(".rt-dropdown__item button",t).on("click",(function(){r=parseInt($(this).text()),r>a?document.location.href="book.html":($(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h())}))}}).create()}$("button#show-more-comments").on("click",(()=>{t.indexes={start:t.indexes.end,end:t.indexes.end+5},t.addSlicedComments(".rt-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5),t.indexes.end<=t.data.length||(l=!0)})),Comment.dynamicTextareaHeight(),$("#main-textarea").on("submit",(function(e){e.preventDefault();const n=$("textarea",$(this));t.data.push(new Comment({name:"Гость",date:(new Date).toLocaleDateString(),text:$(n).val(),img:"./images/guest.png"})),n.val(""),t.indexes.end>=t.data.length&&(l=!0),l&&(t.indexes={start:t.data.length-1,end:t.data.length},t.addSlicedComments("#main-comments"),ShowIt.smoothShowSlicedElements(".rt-comments > .rt-comment",t.indexes,.5))}));let d=[];function h(){$.get("../database/comments/chapter-comments.json",{},(n=>{$(".rt-comments").html(""),d=[],$(n).each(((t,n)=>{n.bookId===e&&n.page===r&&d.push(new Comment(n))})),t.data=d,t.indexes={start:0,end:5},t.addSlicedComments(".rt-comments"),ShowIt.smoothShowSlicedElements(".rt-comment",t.indexes,.5)}))}function p(t){const e=t.split("");let n={},o={start:0,end:3115},a=1;return n[a]=[],$(e).each(((t,e)=>{t>=o.start&&t<=o.end?n[a]+=e:(n[++a]=[],o.start=o.end,o.end+=3115)})),n}function g(){r=1,$.get(`${o[m].link}`,{dataType:"text"},(t=>{n=p(t),a=Object.keys(n).length,$(".rt-page__text").html(n[r]),$(".rt-page__info-page").html(`Страница ${r}`),$(".rt-page__info-chapter").html(`Глава ${m}`),h(),s()}))}h()}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXB0ZXIubWluLmpzIl0sIm5hbWVzIjpbIkRyb3BEb3duIiwiSGlkZUl0IiwiU2hvd0l0IiwiQ29tbWVudCIsIlNsaWNlciIsIiQiLCJzbGljZXIiLCJzdGFydCIsImVuZCIsImJvb2tJZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZWxlY3RvciIsInB4Iiwic2Vjb25kcyIsImNhbGxiYWNrIiwicmVtb3ZlIiwic21vb3RoU2hvdyIsInNtb290aEhpZGVZIiwicGFnZXMiLCJjaGFwdGVycyIsInBhZ2VzQ291bnQiLCJjaGFwdGVyc0NvdW50IiwiY3VycmVudFBhZ2UiLCJjdXJyZW50Q2hhcHRlciIsImdldCIsImRhdGEiLCJlYWNoIiwiaW5kZXgiLCJib29rIiwiaWQiLCJsaW5rIiwiZGF0YVR5cGUiLCJyZXR1cm5QYWdlcyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJhcnJheSIsImkiLCJkYXRhQXRyIiwiYnV0dG9uU2l6ZSIsImxpc3RTaXplIiwidHJhbnNpdGlvbiIsInRpdGxlIiwiaW5wdXROYW1lIiwibGlzdCIsInJldHVybkxpc3QiLCJkcm9wRG93biIsIm9uIiwicGFyc2VJbnQiLCJ0aGlzIiwidGV4dCIsImRvY3VtZW50IiwibG9jYXRpb24iLCJocmVmIiwiaHRtbCIsInVwZGF0ZUNvbW1lbnRzIiwiY3JlYXRlIiwiY2xhc3NlcyIsImNyZWF0ZU5ld0Ryb3BEb3duUGFnZXMiLCJsb2FkTmV3Q2hhcHRlciIsImFsbFNob3dlZCIsIm51bSIsImluZGV4ZXMiLCJhZGRTbGljZWRDb21tZW50cyIsInNtb290aFNob3dTbGljZWRFbGVtZW50cyIsImR5bmFtaWNUZXh0YXJlYUhlaWdodCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ0ZXh0YXJlYSIsInB1c2giLCJuYW1lIiwiZGF0ZSIsIkRhdGUiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJ2YWwiLCJpbWciLCJjb21tZW50cyIsImNvbW1lbnRQcm9wcyIsInBhZ2UiLCJzcGxpdCIsIndheSIsInBhZ2VOdW0iLCJpdGVtIl0sIm1hcHBpbmdzIjoiQUFBQSxvQkFFT0EsYUFBYywyQkFDZEMsV0FBWSx5QkFDWkMsV0FBWSx5QkFDWkMsWUFBYSwwQkFDYkMsV0FBWSxrQkFFbkJDLEdBQUUsS0FDRSxNQUFNQyxFQUFTLElBQUlGLE9BQU8sR0FBSSxDQUFFRyxNQUFPLEVBQUdDLElBQUssSUFDekNDLEdBQVVDLGFBQWFDLFFBQVEsaUJBR3JCLElBQUlWLE9BQU8sQ0FDdkJXLFNBQVUsc0JBQ1ZDLEdBQUksT0FDSkMsUUFBUyxHQUNUQyxTQUFVLEtBQ05WLEVBQUUsY0FBY1csU0FFRCxJQUFJZCxPQUFPLENBQUVVLFNBQVUsMEJBQTJCRSxRQUFTLEtBQ25FRyxnQkFHUEMsY0FJUixJQUdJQyxFQUNBQyxFQUVBQyxFQUNBQyxFQVBBQyxFQUFjLEVBQ2RDLEVBQWlCZCxhQUFhQyxRQUFRLGNBUTFDTixFQUFFb0IsSUFBSSxxQ0FBc0MsSUFBS0MsSUFFN0NyQixFQUFFcUIsR0FBTUMsTUFBSyxDQUFDQyxFQUFPQyxLQUNiQSxFQUFLQyxLQUFPckIsSUFDaEJXLEVBQVdTLEVBQUtULGFBR3BCZixFQUFFb0IsSUFBSSxHQUFHTCxFQUFTSSxHQUFnQk8sT0FBUSxDQUFDQyxTQUFVLFNBQVVELElBQzNEWixFQUFRYyxFQUFZRixHQUVwQlYsRUFBYWEsT0FBT0MsS0FBS2hCLEdBQU9pQixPQUNoQ2QsRUFBZ0JZLE9BQU9DLEtBQUtmLEdBQVVnQixPQUV0QyxNQUFNQyxFQUFRLEdBQ2QsSUFBSUMsRUFBSSxFQUNSLEtBQU9BLEdBQUtqQixFQUFZaUIsSUFBT0QsRUFBTUMsRUFBSSxHQUFLQSxFQUU5QyxJQUFJdEMsU0FBUyxDQUNUdUMsUUFBUyxRQUNUQyxXQUFZLFNBQ1pDLFNBQVUsT0FDVkMsV0FBWSxHQUNaQyxNQUFPLFdBQ1BDLFVBQVcsT0FDWEMsS0FBTUMsRUFBV3pCLEdBQ2pCTixTQUFVLFNBQVNnQyxHQUNDMUMsRUFBRSw0QkFBNkIwQyxHQUV2Q0MsR0FBRyxTQUFTLFdBQ2hCekIsRUFBYzBCLFNBQVM1QyxFQUFFNkMsTUFBTUMsUUFFM0I1QixFQUFjRixFQUNkK0IsU0FBU0MsU0FBU0MsS0FBTyxhQUk3QmpELEVBQUUsa0JBQWtCa0QsS0FBS3BDLEVBQU1JLElBQy9CbEIsRUFBRSx1QkFBdUJrRCxLQUFLLFlBQVloQyxLQUMxQ2xCLEVBQUUsMEJBQTBCa0QsS0FBSyxTQUFTL0IsS0FFMUNnQyxXQUdUQyxTQUVILElBQUl6RCxTQUFTLENBQ1R1QyxRQUFTLFdBQ1RtQixRQUFTLENBQUMsaUJBQ1ZsQixXQUFZLFNBQ1pDLFNBQVUsT0FDVkMsV0FBWSxHQUNaQyxNQUFPLFFBQ1BDLFVBQVcsT0FDWEMsS0FBTUMsRUFBV3hCLEdBQ2pCUCxTQUFVLFNBQVNnQyxHQUNDMUMsRUFBRSw0QkFBNkIwQyxHQUV2Q0MsR0FBRyxTQUFTLFdBQ2hCeEIsRUFBaUJ5QixTQUFTNUMsRUFBRTZDLE1BQU1DLFFBQ2xDNUIsRUFBYyxFQUVkbEIsRUFBRW9CLElBQUksR0FBR0wsRUFBU0ksR0FBZ0JPLE9BQVEsQ0FBQ0MsU0FBVSxTQUFVRCxJQUMzRFosRUFBUWMsRUFBWUYsR0FDcEJWLEVBQWFhLE9BQU9DLEtBQUtoQixHQUFPaUIsT0FFaEMvQixFQUFFLGtCQUFrQmtELEtBQUtwQyxFQUFNSSxJQUMvQmxCLEVBQUUsdUJBQXVCa0QsS0FBSyxZQUFZaEMsS0FDMUNsQixFQUFFLDBCQUEwQmtELEtBQUssU0FBUy9CLEtBRTFDZ0MsSUFDQUcsYUFLYkYsU0FFSHBELEVBQUUsa0JBQWtCa0QsS0FBS3BDLEVBQU1JLElBQy9CbEIsRUFBRSx1QkFBdUJrRCxLQUFLLFlBQVloQyxLQUMxQ2xCLEVBQUUsMEJBQTBCa0QsS0FBSyxTQUFTL0IsV0FRbERuQixFQUFFLG9CQUFvQjJDLEdBQUcsU0FBUyxXQUM5QixHQUFJekIsR0FBZUYsRUFBWSxDQUMzQixHQUFJRCxJQUFXSSxHQUVYLFlBREFvQyxJQUdKUixTQUFTQyxTQUFTQyxLQUFPLFlBRzdCakQsRUFBRSxrQkFBa0JrRCxLQUFLcEMsSUFBUUksSUFDakNsQixFQUFFLHVCQUF1QmtELEtBQUssWUFBWWhDLEtBQzFDbEIsRUFBRSwwQkFBMEJrRCxLQUFLLFNBQVMvQixLQUUxQ2dDLE9BTUpuRCxFQUFFLG9CQUFvQjJDLEdBQUcsU0FBUyxXQUM5QixHQUFvQixJQUFoQnpCLEVBQW1CLENBQ25CLEdBQUlILElBQVdJLEdBRVgsWUFEQW9DLElBR0pSLFNBQVNDLFNBQVNDLEtBQU8sWUFHN0JqRCxFQUFFLGtCQUFrQmtELEtBQUtwQyxJQUFRSSxJQUNqQ2xCLEVBQUUsdUJBQXVCa0QsS0FBSyxZQUFZaEMsS0FDMUNsQixFQUFFLDBCQUEwQmtELEtBQUssU0FBUy9CLEtBRTFDZ0MsT0FNSixJQUFJSyxHQUFZLEVBc0NoQixTQUFTZixFQUFXZ0IsR0FDaEIsTUFBTXpCLEVBQVEsR0FDZCxJQUFJLElBQUlDLEVBQUksRUFBR0EsR0FBS3dCLEVBQUt4QixJQUFPRCxFQUFNQyxFQUFJLEdBQUtBLEVBQy9DLE9BQU9ELEVBR1gsU0FBU3NCLElBQ0x0RCxFQUFFLDJCQUEyQmtELEtBQUssSUFDbEMsSUFBSXZELFNBQVMsQ0FDVHVDLFFBQVMsUUFDVEMsV0FBWSxTQUNaQyxTQUFVLE9BQ1ZDLFdBQVksR0FDWkMsTUFBTyxXQUNQQyxVQUFXLE9BQ1hDLEtBQU1DLEVBQVd6QixHQUNqQk4sU0FBVSxTQUFTZ0MsR0FDQzFDLEVBQUUsNEJBQTZCMEMsR0FFdkNDLEdBQUcsU0FBUyxXQUNoQnpCLEVBQWMwQixTQUFTNUMsRUFBRTZDLE1BQU1DLFFBRTNCNUIsRUFBY0YsRUFDZCtCLFNBQVNDLFNBQVNDLEtBQU8sYUFJN0JqRCxFQUFFLGtCQUFrQmtELEtBQUtwQyxFQUFNSSxJQUMvQmxCLEVBQUUsdUJBQXVCa0QsS0FBSyxZQUFZaEMsS0FDMUNsQixFQUFFLDBCQUEwQmtELEtBQUssU0FBUy9CLEtBRTFDZ0MsV0FHVEMsU0F2RVBwRCxFQUFFLDZCQUE2QjJDLEdBQUcsU0FBUyxLQUN2QzFDLEVBQU95RCxRQUFVLENBQUV4RCxNQUFPRCxFQUFPeUQsUUFBUXZELElBQUtBLElBQUtGLEVBQU95RCxRQUFRdkQsSUFBTSxHQUN4RUYsRUFBTzBELGtCQUFrQixnQkFDekI5RCxPQUFPK0QseUJBQXlCLGNBQWUzRCxFQUFPeUQsUUFBUyxJQUUzRHpELEVBQU95RCxRQUFRdkQsS0FBT0YsRUFBT29CLEtBQUtVLFNBQ3RDeUIsR0FBWSxNQU1oQjFELFFBQVErRCx3QkFDUjdELEVBQUUsa0JBQWtCMkMsR0FBRyxVQUFVLFNBQVNtQixHQUN0Q0EsRUFBTUMsaUJBRU4sTUFBTUMsRUFBV2hFLEVBQUUsV0FBWUEsRUFBRTZDLE9BRWpDNUMsRUFBT29CLEtBQUs0QyxLQUFLLElBQUluRSxRQUFRLENBQ3pCb0UsS0FBTSxRQUNOQyxNQUFNLElBQUlDLE1BQU9DLHFCQUNqQnZCLEtBQU05QyxFQUFFZ0UsR0FBVU0sTUFDbEJDLElBQUssd0JBRVRQLEVBQVNNLElBQUksSUFFVHJFLEVBQU95RCxRQUFRdkQsS0FBT0YsRUFBT29CLEtBQUtVLFNBQVF5QixHQUFZLEdBQ25EQSxJQUVQdkQsRUFBT3lELFFBQVUsQ0FBRXhELE1BQU9ELEVBQU9vQixLQUFLVSxPQUFTLEVBQUc1QixJQUFLRixFQUFPb0IsS0FBS1UsUUFDbkU5QixFQUFPMEQsa0JBQWtCLGtCQUN6QjlELE9BQU8rRCx5QkFBeUIsNkJBQThCM0QsRUFBT3lELFFBQVMsUUE2RGxGLElBQUljLEVBQVcsR0FDZixTQUFTckIsSUFDTG5ELEVBQUVvQixJQUFJLDZDQUE4QyxJQUFLQyxJQUNyRHJCLEVBQUUsZ0JBQWdCa0QsS0FBSyxJQUN2QnNCLEVBQVcsR0FFWHhFLEVBQUVxQixHQUFNQyxNQUFLLENBQUNDLEVBQU9rRCxLQUViQSxFQUFhckUsU0FBV0EsR0FDeEJxRSxFQUFhQyxPQUFTeEQsR0FDMUJzRCxFQUFTUCxLQUFLLElBQUluRSxRQUFRMkUsT0FHOUJ4RSxFQUFPb0IsS0FBT21ELEVBQ2R2RSxFQUFPeUQsUUFBVSxDQUFFeEQsTUFBTyxFQUFHQyxJQUFLLEdBQ2xDRixFQUFPMEQsa0JBQWtCLGdCQUN6QjlELE9BQU8rRCx5QkFBeUIsY0FBZTNELEVBQU95RCxRQUFTLE9BS3ZFLFNBQVM5QixFQUFZUCxHQUNqQixNQUFNVyxFQUFRWCxFQUFLc0QsTUFBTSxJQUN6QixJQUFJN0QsRUFBUSxHQUNSOEQsRUFBTSxDQUFFMUUsTUFBTyxFQUFHQyxJQUFLLE1BQ3ZCMEUsRUFBVSxFQWNkLE9BWEEvRCxFQUFNK0QsR0FBVyxHQUNqQjdFLEVBQUVnQyxHQUFPVixNQUFLLENBQUNDLEVBQU91RCxLQUNkdkQsR0FBU3FELEVBQUkxRSxPQUFTcUIsR0FBU3FELEVBQUl6RSxJQUNuQ1csRUFBTStELElBQVlDLEdBR3RCaEUsSUFBUStELEdBQVcsR0FDbkJELEVBQUkxRSxNQUFRMEUsRUFBSXpFLElBQ2hCeUUsRUFBSXpFLEtBQU8sU0FHUlcsRUFHWCxTQUFTeUMsSUFDTHJDLEVBQWMsRUFFZGxCLEVBQUVvQixJQUFJLEdBQUdMLEVBQVNJLEdBQWdCTyxPQUFRLENBQUNDLFNBQVUsU0FBVUQsSUFDM0RaLEVBQVFjLEVBQVlGLEdBQ3BCVixFQUFhYSxPQUFPQyxLQUFLaEIsR0FBT2lCLE9BRWhDL0IsRUFBRSxrQkFBa0JrRCxLQUFLcEMsRUFBTUksSUFDL0JsQixFQUFFLHVCQUF1QmtELEtBQUssWUFBWWhDLEtBQzFDbEIsRUFBRSwwQkFBMEJrRCxLQUFLLFNBQVMvQixLQUUxQ2dDLElBQ0FHLE9BbkNSSCIsImZpbGUiOiJjaGFwdGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmltcG9ydCBEcm9wRG93biBmcm9tICcuL0Ryb3BEb3duLm1pbi5qcyc7XHJcbmltcG9ydCBIaWRlSXQgZnJvbSAnLi9IaWRlSXQubWluLmpzJztcclxuaW1wb3J0IFNob3dJdCBmcm9tICcuL1Nob3dJdC5taW4uanMnO1xyXG5pbXBvcnQgQ29tbWVudCBmcm9tICcuL0NvbW1lbnQubWluLmpzJztcclxuaW1wb3J0IFNsaWNlciBmcm9tICcuL1NsaWNlci5taW4uanMnO1xyXG5cclxuJCgoKSA9PiB7XHJcbiAgICBjb25zdCBzbGljZXIgPSBuZXcgU2xpY2VyKFtdLCB7IHN0YXJ0OiAwLCBlbmQ6IDUgfSk7IFxyXG4gICAgY29uc3QgYm9va0lkID0gK2xvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50Qm9va0lkJyk7XHJcblxyXG4gICAgLy8gU01PT1RIIFNIT1cgLS0tLT5cclxuICAgIGNvbnN0IHNwaW5uZXIgPSBuZXcgSGlkZUl0KHtcclxuICAgICAgICBzZWxlY3RvcjogJy5ydC1sb2FkZXJfX2NvbnRlbnQnLFxyXG4gICAgICAgIHB4OiAnNTBweCcsXHJcbiAgICAgICAgc2Vjb25kczogMC41LFxyXG4gICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICQoJy5ydC1sb2FkZXInKS5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGJsb2NrcyA9IG5ldyBTaG93SXQoeyBzZWxlY3RvcjogJ2hlYWRlciwgZm9vdGVyLCBzZWN0aW9uJywgc2Vjb25kczogMC41IH0pO1xyXG4gICAgICAgICAgICBibG9ja3Muc21vb3RoU2hvdygpOyAgICBcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgc3Bpbm5lci5zbW9vdGhIaWRlWSgpO1xyXG4gICAgLy8gPC0tLS0gU01PT1RIIFNIT1dcclxuXHJcbiAgICBcclxuICAgIGxldCBjdXJyZW50UGFnZSA9IDE7XHJcbiAgICBsZXQgY3VycmVudENoYXB0ZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY2hhcHRlck51bScpO1xyXG5cclxuICAgIGxldCBwYWdlcztcclxuICAgIGxldCBjaGFwdGVycztcclxuXHJcbiAgICBsZXQgcGFnZXNDb3VudDtcclxuICAgIGxldCBjaGFwdGVyc0NvdW50O1xyXG5cclxuICAgICQuZ2V0KCcuLi9kYXRhYmFzZS9ib29rcy9pbmZvcm1hdGlvbi5qc29uJywge30sIChkYXRhKSA9PiB7XHJcblxyXG4gICAgICAgICQoZGF0YSkuZWFjaCgoaW5kZXgsIGJvb2spID0+IHtcclxuICAgICAgICAgICAgaWYgKGJvb2suaWQgIT09IGJvb2tJZCkgcmV0dXJuXHJcbiAgICAgICAgICAgIGNoYXB0ZXJzID0gYm9vay5jaGFwdGVycztcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAkLmdldChgJHtjaGFwdGVyc1tjdXJyZW50Q2hhcHRlcl0ubGlua31gLCB7ZGF0YVR5cGU6IFwidGV4dFwifSwgKGxpbmspID0+IHtcclxuICAgICAgICAgICAgcGFnZXMgPSByZXR1cm5QYWdlcyhsaW5rKTtcclxuXHJcbiAgICAgICAgICAgIHBhZ2VzQ291bnQgPSBPYmplY3Qua2V5cyhwYWdlcykubGVuZ3RoXHJcbiAgICAgICAgICAgIGNoYXB0ZXJzQ291bnQgPSBPYmplY3Qua2V5cyhjaGFwdGVycykubGVuZ3RoXHJcblxyXG4gICAgICAgICAgICBjb25zdCBhcnJheSA9IFtdO1xyXG4gICAgICAgICAgICBsZXQgaSA9IDE7XHJcbiAgICAgICAgICAgIGZvcihpOyBpIDw9IHBhZ2VzQ291bnQ7IGkrKykgeyBhcnJheVtpIC0gMV0gPSBpIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBuZXcgRHJvcERvd24oe1xyXG4gICAgICAgICAgICAgICAgZGF0YUF0cjogJ3BhZ2VzJyxcclxuICAgICAgICAgICAgICAgIGJ1dHRvblNpemU6ICdub3JtYWwnLFxyXG4gICAgICAgICAgICAgICAgbGlzdFNpemU6ICcxMDAlJyxcclxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IDAuMixcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAn0KHRgtGA0LDQvdC40YbRiycsXHJcbiAgICAgICAgICAgICAgICBpbnB1dE5hbWU6ICdsaW5rJyxcclxuICAgICAgICAgICAgICAgIGxpc3Q6IHJldHVybkxpc3QocGFnZXNDb3VudCksXHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oZHJvcERvd24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBidXR0b25zID0gJCgnLnJ0LWRyb3Bkb3duX19pdGVtIGJ1dHRvbicsIGRyb3BEb3duICk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbnMub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gcGFyc2VJbnQoJCh0aGlzKS50ZXh0KCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQYWdlID4gcGFnZXNDb3VudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IFwiYm9vay5odG1sXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX190ZXh0JykuaHRtbChwYWdlc1tjdXJyZW50UGFnZV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1wYWdlJykuaHRtbChg0KHRgtGA0LDQvdC40YbQsCAke2N1cnJlbnRQYWdlfWApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1jaGFwdGVyJykuaHRtbChg0JPQu9Cw0LLQsCAke2N1cnJlbnRDaGFwdGVyfWApO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNvbW1lbnRzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkuY3JlYXRlKCk7XHJcblxyXG4gICAgICAgICAgICBuZXcgRHJvcERvd24oe1xyXG4gICAgICAgICAgICAgICAgZGF0YUF0cjogJ2NoYXB0ZXJzJyxcclxuICAgICAgICAgICAgICAgIGNsYXNzZXM6IFsncnQtbXItZGVmYXVsdCddLFxyXG4gICAgICAgICAgICAgICAgYnV0dG9uU2l6ZTogJ25vcm1hbCcsXHJcbiAgICAgICAgICAgICAgICBsaXN0U2l6ZTogJzEwMCUnLFxyXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogMC4yLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICfQk9C70LDQstGLJyxcclxuICAgICAgICAgICAgICAgIGlucHV0TmFtZTogJ2xpbmsnLFxyXG4gICAgICAgICAgICAgICAgbGlzdDogcmV0dXJuTGlzdChjaGFwdGVyc0NvdW50KSxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihkcm9wRG93bikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSAkKCcucnQtZHJvcGRvd25fX2l0ZW0gYnV0dG9uJywgZHJvcERvd24gKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9ucy5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXB0ZXIgPSBwYXJzZUludCgkKHRoaXMpLnRleHQoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZ2V0KGAke2NoYXB0ZXJzW2N1cnJlbnRDaGFwdGVyXS5saW5rfWAsIHtkYXRhVHlwZTogXCJ0ZXh0XCJ9LCAobGluaykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZXMgPSByZXR1cm5QYWdlcyhsaW5rKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VzQ291bnQgPSBPYmplY3Qua2V5cyhwYWdlcykubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX190ZXh0JykuaHRtbChwYWdlc1tjdXJyZW50UGFnZV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tcGFnZScpLmh0bWwoYNCh0YLRgNCw0L3QuNGG0LAgJHtjdXJyZW50UGFnZX1gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVDb21tZW50cygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlTmV3RHJvcERvd25QYWdlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS5jcmVhdGUoKTtcclxuXHJcbiAgICAgICAgICAgICQoJy5ydC1wYWdlX190ZXh0JykuaHRtbChwYWdlc1tjdXJyZW50UGFnZV0pO1xyXG4gICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1wYWdlJykuaHRtbChg0KHRgtGA0LDQvdC40YbQsCAke2N1cnJlbnRQYWdlfWApO1xyXG4gICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1jaGFwdGVyJykuaHRtbChg0JPQu9Cw0LLQsCAke2N1cnJlbnRDaGFwdGVyfWApO1xyXG4gICAgICAgIH0pXHJcbiBcclxuICAgIH0pXHJcblxyXG4gICAgXHJcblxyXG4gICAgLy8gQlVUVE9OIE5FWFQgUEFHRSAtLS0+XHJcbiAgICAkKCdidXR0b24jbmV4dC1wYWdlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRQYWdlID49IHBhZ2VzQ291bnQpIHtcclxuICAgICAgICAgICAgaWYgKGNoYXB0ZXJzWysrY3VycmVudENoYXB0ZXJdKSB7XHJcbiAgICAgICAgICAgICAgICBsb2FkTmV3Q2hhcHRlcigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IFwiYm9vay5odG1sXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKCcucnQtcGFnZV9fdGV4dCcpLmh0bWwocGFnZXNbKytjdXJyZW50UGFnZV0pXHJcbiAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tcGFnZScpLmh0bWwoYNCh0YLRgNCw0L3QuNGG0LAgJHtjdXJyZW50UGFnZX1gKTtcclxuICAgICAgICAkKCcucnQtcGFnZV9faW5mby1jaGFwdGVyJykuaHRtbChg0JPQu9Cw0LLQsCAke2N1cnJlbnRDaGFwdGVyfWApO1xyXG5cclxuICAgICAgICB1cGRhdGVDb21tZW50cygpO1xyXG4gICAgfSlcclxuICAgIC8vIDwtLS0tIEJVVFRPTiBORVhUIFBBR0VcclxuXHJcblxyXG4gICAgLy8gQlVUVE9OIExBU1QgUEFHRSAtLS0+XHJcbiAgICAkKCdidXR0b24jbGFzdC1wYWdlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRQYWdlID09PSAxKSB7XHJcbiAgICAgICAgICAgIGlmIChjaGFwdGVyc1stLWN1cnJlbnRDaGFwdGVyXSkge1xyXG4gICAgICAgICAgICAgICAgbG9hZE5ld0NoYXB0ZXIoKTtcclxuICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBcImJvb2suaHRtbFwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJCgnLnJ0LXBhZ2VfX3RleHQnKS5odG1sKHBhZ2VzWy0tY3VycmVudFBhZ2VdKVxyXG4gICAgICAgICQoJy5ydC1wYWdlX19pbmZvLXBhZ2UnKS5odG1sKGDQodGC0YDQsNC90LjRhtCwICR7Y3VycmVudFBhZ2V9YCk7XHJcbiAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tY2hhcHRlcicpLmh0bWwoYNCT0LvQsNCy0LAgJHtjdXJyZW50Q2hhcHRlcn1gKTtcclxuXHJcbiAgICAgICAgdXBkYXRlQ29tbWVudHMoKTtcclxuICAgIH0pXHJcbiAgICAvLyA8LS0tLSBCVVRUT04gTEFTVCBQQUdFXHJcblxyXG5cclxuICAgIC8vIFNIT1cgTU9SRSBDT01NRU5UUyAtLS0tPlxyXG4gICAgbGV0IGFsbFNob3dlZCA9IGZhbHNlO1xyXG4gICAgJCgnYnV0dG9uI3Nob3ctbW9yZS1jb21tZW50cycpLm9uKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICBzbGljZXIuaW5kZXhlcyA9IHsgc3RhcnQ6IHNsaWNlci5pbmRleGVzLmVuZCwgZW5kOiBzbGljZXIuaW5kZXhlcy5lbmQgKyA1IH07XHJcbiAgICAgICAgc2xpY2VyLmFkZFNsaWNlZENvbW1lbnRzKCcucnQtY29tbWVudHMnKTtcclxuICAgICAgICBTaG93SXQuc21vb3RoU2hvd1NsaWNlZEVsZW1lbnRzKCcucnQtY29tbWVudCcsIHNsaWNlci5pbmRleGVzLCAwLjUpO1xyXG5cclxuICAgICAgICBpZiAoc2xpY2VyLmluZGV4ZXMuZW5kIDw9IHNsaWNlci5kYXRhLmxlbmd0aCkgcmV0dXJuXHJcbiAgICAgICAgYWxsU2hvd2VkID0gdHJ1ZTsgICBcclxuICAgIH0pXHJcbiAgICAvLyA8LS0tLSBTSE9XIE1PUkUgQ09NTUVOVFNcclxuXHJcblxyXG4gICAgLy8gVEVYVEFSRUEgLS0tLT5cclxuICAgIENvbW1lbnQuZHluYW1pY1RleHRhcmVhSGVpZ2h0KCk7XHJcbiAgICAkKCcjbWFpbi10ZXh0YXJlYScpLm9uKCdzdWJtaXQnLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRleHRhcmVhID0gJCgndGV4dGFyZWEnLCAkKHRoaXMpKTtcclxuICAgICAgICBcclxuICAgICAgICBzbGljZXIuZGF0YS5wdXNoKG5ldyBDb21tZW50KHtcclxuICAgICAgICAgICAgbmFtZTogJ9CT0L7RgdGC0YwnLFxyXG4gICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpLFxyXG4gICAgICAgICAgICB0ZXh0OiAkKHRleHRhcmVhKS52YWwoKSxcclxuICAgICAgICAgICAgaW1nOiAnLi9pbWFnZXMvZ3Vlc3QucG5nJ1xyXG4gICAgICAgIH0pKVxyXG4gICAgICAgIHRleHRhcmVhLnZhbCgnJyk7XHJcblxyXG4gICAgICAgIGlmIChzbGljZXIuaW5kZXhlcy5lbmQgPj0gc2xpY2VyLmRhdGEubGVuZ3RoKSBhbGxTaG93ZWQgPSB0cnVlOyAgIFxyXG4gICAgICAgIGlmICggISBhbGxTaG93ZWQpIHJldHVyblxyXG5cclxuICAgICAgICBzbGljZXIuaW5kZXhlcyA9IHsgc3RhcnQ6IHNsaWNlci5kYXRhLmxlbmd0aCAtIDEsIGVuZDogc2xpY2VyLmRhdGEubGVuZ3RoIH07XHJcbiAgICAgICAgc2xpY2VyLmFkZFNsaWNlZENvbW1lbnRzKCcjbWFpbi1jb21tZW50cycpO1xyXG4gICAgICAgIFNob3dJdC5zbW9vdGhTaG93U2xpY2VkRWxlbWVudHMoJy5ydC1jb21tZW50cyA+IC5ydC1jb21tZW50Jywgc2xpY2VyLmluZGV4ZXMsIDAuNSk7XHJcbiAgICB9KVxyXG4gICAgLy8gPC0tLS0gVEVYVEFSRUFcclxuXHJcblxyXG4gICAgLy8gSEVMUEVSIEZVTkNUSU9OUyAtLS0tPlxyXG4gICAgZnVuY3Rpb24gcmV0dXJuTGlzdChudW0pIHtcclxuICAgICAgICBjb25zdCBhcnJheSA9IFtdO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDE7IGkgPD0gbnVtOyBpKyspIHsgYXJyYXlbaSAtIDFdID0gaSB9O1xyXG4gICAgICAgIHJldHVybiBhcnJheVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBjcmVhdGVOZXdEcm9wRG93blBhZ2VzKCkge1xyXG4gICAgICAgICQoJ1tkYXRhLWRyb3Bkb3duPVwicGFnZXNcIl0nKS5odG1sKCcnKTtcclxuICAgICAgICBuZXcgRHJvcERvd24oe1xyXG4gICAgICAgICAgICBkYXRhQXRyOiAncGFnZXMnLFxyXG4gICAgICAgICAgICBidXR0b25TaXplOiAnbm9ybWFsJyxcclxuICAgICAgICAgICAgbGlzdFNpemU6ICcxMDAlJyxcclxuICAgICAgICAgICAgdHJhbnNpdGlvbjogMC4yLFxyXG4gICAgICAgICAgICB0aXRsZTogJ9Ch0YLRgNCw0L3QuNGG0YsnLFxyXG4gICAgICAgICAgICBpbnB1dE5hbWU6ICdsaW5rJyxcclxuICAgICAgICAgICAgbGlzdDogcmV0dXJuTGlzdChwYWdlc0NvdW50KSxcclxuICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKGRyb3BEb3duKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBidXR0b25zID0gJCgnLnJ0LWRyb3Bkb3duX19pdGVtIGJ1dHRvbicsIGRyb3BEb3duICk7XHJcblxyXG4gICAgICAgICAgICAgICAgYnV0dG9ucy5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGFnZSA9IHBhcnNlSW50KCQodGhpcykudGV4dCgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQYWdlID4gcGFnZXNDb3VudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gXCJib29rLmh0bWxcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAkKCcucnQtcGFnZV9fdGV4dCcpLmh0bWwocGFnZXNbY3VycmVudFBhZ2VdKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcucnQtcGFnZV9faW5mby1wYWdlJykuaHRtbChg0KHRgtGA0LDQvdC40YbQsCAke2N1cnJlbnRQYWdlfWApO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5ydC1wYWdlX19pbmZvLWNoYXB0ZXInKS5odG1sKGDQk9C70LDQstCwICR7Y3VycmVudENoYXB0ZXJ9YCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNvbW1lbnRzKCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkuY3JlYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJvcERvd24ocHJvcHMsIGNvdW50KSB7XHJcbiAgICAgICAgY29uc3QgYXJyYXkgPSBbXTtcclxuICAgICAgICBsZXQgaSA9IDE7XHJcbiAgICAgICAgZm9yKGk7IGkgPD0gY291bnQ7IGkrKykgeyBhcnJheVtpIC0gMV0gPSBpIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIG5ldyBEcm9wRG93bih7XHJcbiAgICAgICAgICAgIGRhdGFBdHI6IHByb3BzLmRhdGFBdHIsXHJcbiAgICAgICAgICAgIGNsYXNzZXM6IHByb3BzLmNsYXNzZXMsXHJcbiAgICAgICAgICAgIGJ1dHRvblNpemU6IHByb3BzLmJ1dHRvblNpemUsXHJcbiAgICAgICAgICAgIGxpc3RTaXplOiBwcm9wcy5saXN0U2l6ZSxcclxuICAgICAgICAgICAgdHJhbnNpdGlvbjogcHJvcHMudHJhbnNpdGlvbixcclxuICAgICAgICAgICAgdGl0bGU6IHByb3BzLnRpdGxlLFxyXG4gICAgICAgICAgICBpbnB1dE5hbWU6IHByb3BzLmlucHV0TmFtZSxcclxuICAgICAgICAgICAgY2FsbGJhY2s6IHByb3BzLmNhbGxiYWNrLFxyXG4gICAgICAgICAgICBsaXN0OiBhcnJheVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGNvbW1lbnRzID0gW107XHJcbiAgICBmdW5jdGlvbiB1cGRhdGVDb21tZW50cygpIHtcclxuICAgICAgICAkLmdldCgnLi4vZGF0YWJhc2UvY29tbWVudHMvY2hhcHRlci1jb21tZW50cy5qc29uJywge30sIChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICQoJy5ydC1jb21tZW50cycpLmh0bWwoJycpO1xyXG4gICAgICAgICAgICBjb21tZW50cyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgJChkYXRhKS5lYWNoKChpbmRleCwgY29tbWVudFByb3BzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmIChjb21tZW50UHJvcHMuYm9va0lkICE9PSBib29rSWQpIHJldHVyblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbW1lbnRQcm9wcy5wYWdlICE9PSBjdXJyZW50UGFnZSkgcmV0dXJuXHJcbiAgICAgICAgICAgICAgICBjb21tZW50cy5wdXNoKG5ldyBDb21tZW50KGNvbW1lbnRQcm9wcykpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgXHJcbiAgICAgICAgICAgIHNsaWNlci5kYXRhID0gY29tbWVudHM7XHJcbiAgICAgICAgICAgIHNsaWNlci5pbmRleGVzID0geyBzdGFydDogMCwgZW5kOiA1IH07XHJcbiAgICAgICAgICAgIHNsaWNlci5hZGRTbGljZWRDb21tZW50cygnLnJ0LWNvbW1lbnRzJyk7XHJcbiAgICAgICAgICAgIFNob3dJdC5zbW9vdGhTaG93U2xpY2VkRWxlbWVudHMoJy5ydC1jb21tZW50Jywgc2xpY2VyLmluZGV4ZXMsIDAuNSk7IFxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICB1cGRhdGVDb21tZW50cygpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHJldHVyblBhZ2VzKGRhdGEpIHtcclxuICAgICAgICBjb25zdCBhcnJheSA9IGRhdGEuc3BsaXQoJycpO1xyXG4gICAgICAgIGxldCBwYWdlcyA9IHt9O1xyXG4gICAgICAgIGxldCB3YXkgPSB7IHN0YXJ0OiAwLCBlbmQ6IDMxMTV9O1xyXG4gICAgICAgIGxldCBwYWdlTnVtID0gMTtcclxuXHJcblxyXG4gICAgICAgIHBhZ2VzW3BhZ2VOdW1dID0gW107XHJcbiAgICAgICAgJChhcnJheSkuZWFjaCgoaW5kZXgsIGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID49IHdheS5zdGFydCAmJiBpbmRleCA8PSB3YXkuZW5kKSB7XHJcbiAgICAgICAgICAgICAgICBwYWdlc1twYWdlTnVtXSArPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcGFnZXNbKytwYWdlTnVtXSA9IFtdO1xyXG4gICAgICAgICAgICB3YXkuc3RhcnQgPSB3YXkuZW5kO1xyXG4gICAgICAgICAgICB3YXkuZW5kICs9IDMxMTU7XHJcbiAgICAgICAgfSlcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gcGFnZXMgXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbG9hZE5ld0NoYXB0ZXIoKSB7XHJcbiAgICAgICAgY3VycmVudFBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAkLmdldChgJHtjaGFwdGVyc1tjdXJyZW50Q2hhcHRlcl0ubGlua31gLCB7ZGF0YVR5cGU6IFwidGV4dFwifSwgKGxpbmspID0+IHtcclxuICAgICAgICAgICAgcGFnZXMgPSByZXR1cm5QYWdlcyhsaW5rKTtcclxuICAgICAgICAgICAgcGFnZXNDb3VudCA9IE9iamVjdC5rZXlzKHBhZ2VzKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAkKCcucnQtcGFnZV9fdGV4dCcpLmh0bWwocGFnZXNbY3VycmVudFBhZ2VdKTtcclxuICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tcGFnZScpLmh0bWwoYNCh0YLRgNCw0L3QuNGG0LAgJHtjdXJyZW50UGFnZX1gKTtcclxuICAgICAgICAgICAgJCgnLnJ0LXBhZ2VfX2luZm8tY2hhcHRlcicpLmh0bWwoYNCT0LvQsNCy0LAgJHtjdXJyZW50Q2hhcHRlcn1gKTtcclxuICAgIFxyXG4gICAgICAgICAgICB1cGRhdGVDb21tZW50cygpO1xyXG4gICAgICAgICAgICBjcmVhdGVOZXdEcm9wRG93blBhZ2VzKCk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIC8vIDwtLS0tIEhFTFBFUiBGVU5DVElPTlNcclxuXHJcbn0pIl19
